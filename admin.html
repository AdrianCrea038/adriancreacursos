<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel Admin ¬∑ Adrian Creativo</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root {
  --blue-deep:#0A0AE8;--blue-royal:#1A1AFF;--blue-bright:#3D3DFF;--blue-light:#6B6BFF;
  --green-neon:#00FF88;--green-mid:#00CC6A;--white:#FFFFFF;--off-white:#F4F4FF;
  --gray-100:#EEEEF8;--gray-200:#D8D8F0;--gray-400:#9090B8;--gray-600:#5A5A80;
  --dark:#08081A;--dark-2:#0F0F2A;--dark-3:#161640;--dark-surface:#1A1A4A;
  --danger:#FF4466;--warning:#FFAA00;--success:#00CC6A;
  --sidebar-w:260px;--topbar-h:64px;
  --radius-sm:8px;--radius-md:14px;--radius-lg:20px;--radius-xl:28px;
  --shadow-sm:0 2px 8px rgba(10,10,232,0.12);
  --shadow-md:0 8px 32px rgba(10,10,232,0.18);
  --shadow-lg:0 16px 64px rgba(10,10,232,0.25);
  --transition:all 0.4s cubic-bezier(0.16,1,0.3,1);
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{font-family:'Outfit',sans-serif;background:var(--dark);color:var(--white);min-height:100vh;overflow-x:hidden}

/* LOGIN */
#loginScreen{position:fixed;inset:0;background:var(--dark);display:flex;align-items:center;justify-content:center;z-index:9999;overflow:hidden}
.login-bg{position:absolute;inset:0;background:radial-gradient(ellipse 80% 60% at 50% -10%,rgba(26,26,255,0.5) 0%,transparent 70%),radial-gradient(ellipse 60% 40% at 100% 100%,rgba(0,255,136,0.15) 0%,transparent 60%),var(--dark)}
.login-orbs{position:absolute;inset:0;pointer-events:none}
.orb{position:absolute;border-radius:50%;filter:blur(80px);opacity:.35;animation:floatOrb 8s ease-in-out infinite}
.orb-1{width:400px;height:400px;background:var(--blue-royal);top:-100px;left:-100px;animation-delay:0s}
.orb-2{width:300px;height:300px;background:var(--green-neon);bottom:-80px;right:-80px;animation-delay:-3s}
.orb-3{width:200px;height:200px;background:var(--blue-bright);top:50%;right:15%;animation-delay:-6s}
@keyframes floatOrb{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-30px) scale(1.05)}}
.login-card{position:relative;z-index:1;background:rgba(255,255,255,0.04);backdrop-filter:blur(40px);border:1px solid rgba(255,255,255,0.1);border-radius:var(--radius-xl);padding:48px 44px;width:100%;max-width:440px;box-shadow:var(--shadow-lg),inset 0 1px 0 rgba(255,255,255,0.1);animation:slideUp .7s cubic-bezier(0.16,1,0.3,1) both}
@keyframes slideUp{from{opacity:0;transform:translateY(40px)}to{opacity:1;transform:translateY(0)}}
.login-logo{text-align:center;margin-bottom:36px}
.logo-icon{width:64px;height:64px;background:linear-gradient(135deg,var(--blue-royal),var(--green-neon));border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;margin:0 auto 14px;font-size:28px;color:white;box-shadow:var(--shadow-md);animation:pulseGlow 3s ease-in-out infinite}
@keyframes pulseGlow{0%,100%{box-shadow:var(--shadow-md)}50%{box-shadow:var(--shadow-md),0 0 40px rgba(0,255,136,0.3)}}
.login-logo h1{font-size:22px;font-weight:700;letter-spacing:-.5px;background:linear-gradient(135deg,#fff 40%,var(--green-neon));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.login-logo p{color:var(--gray-400);font-size:13px;margin-top:4px}
.login-tabs{display:flex;background:rgba(255,255,255,0.05);border-radius:var(--radius-sm);padding:4px;margin-bottom:28px;gap:4px}
.login-tab{flex:1;padding:9px;border:none;background:none;color:var(--gray-400);font-family:'Outfit',sans-serif;font-size:13px;font-weight:500;cursor:pointer;border-radius:6px;transition:var(--transition)}
.login-tab.active{background:linear-gradient(135deg,var(--blue-royal),var(--blue-bright));color:white;box-shadow:var(--shadow-sm)}
.form-group{margin-bottom:18px}
.form-label{display:block;font-size:12px;font-weight:600;color:var(--gray-400);letter-spacing:.06em;text-transform:uppercase;margin-bottom:8px}
.input-wrap{position:relative}
.input-wrap i{position:absolute;left:14px;top:50%;transform:translateY(-50%);color:var(--gray-400);font-size:14px;transition:var(--transition);pointer-events:none}
.form-input{width:100%;padding:13px 14px 13px 42px;background:rgba(255,255,255,0.06);border:1.5px solid rgba(255,255,255,0.1);border-radius:var(--radius-sm);color:white;font-family:'Outfit',sans-serif;font-size:15px;outline:none;transition:var(--transition)}
.form-input::placeholder{color:var(--gray-600)}
.form-input:focus{border-color:var(--blue-bright);background:rgba(61,61,255,0.1);box-shadow:0 0 0 4px rgba(61,61,255,0.15)}
.btn-login{width:100%;padding:15px;background:linear-gradient(135deg,var(--blue-royal) 0%,var(--blue-bright) 50%,var(--green-mid) 100%);background-size:200% 100%;border:none;border-radius:var(--radius-sm);color:white;font-family:'Outfit',sans-serif;font-size:15px;font-weight:700;letter-spacing:.02em;cursor:pointer;transition:var(--transition);position:relative;overflow:hidden;margin-top:8px}
.btn-login:hover{background-position:right center;transform:translateY(-1px);box-shadow:var(--shadow-md)}
.login-error{display:none;margin-top:14px;background:rgba(255,68,102,0.12);border:1px solid rgba(255,68,102,0.3);border-radius:var(--radius-sm);padding:11px 14px;color:#FF7799;font-size:13px;text-align:center}
.login-error.show{display:block;animation:shake .4s ease}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}

/* APP */
#appShell{display:none;min-height:100vh}
#appShell.visible{display:flex}

/* SIDEBAR */
.sidebar{width:var(--sidebar-w);background:linear-gradient(180deg,var(--dark-2) 0%,var(--dark-3) 100%);border-right:1px solid rgba(255,255,255,0.06);display:flex;flex-direction:column;position:fixed;left:0;top:0;bottom:0;z-index:100;transition:var(--transition);overflow:hidden}
.sidebar::before{content:'';position:absolute;top:0;left:0;right:0;height:200px;background:radial-gradient(ellipse at 50% 0%,rgba(26,26,255,0.3) 0%,transparent 70%);pointer-events:none}
.sidebar-header{padding:24px 20px;border-bottom:1px solid rgba(255,255,255,0.06);display:flex;align-items:center;gap:12px;position:relative}
.sidebar-logo{width:42px;height:42px;flex-shrink:0;background:linear-gradient(135deg,var(--blue-royal),var(--green-neon));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;color:white;box-shadow:var(--shadow-sm)}
.sidebar-brand h2{font-size:15px;font-weight:700;letter-spacing:-.3px;background:linear-gradient(135deg,#fff,var(--green-neon));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.sidebar-brand span{font-size:10px;font-weight:500;color:var(--gray-400);letter-spacing:.08em;text-transform:uppercase}
.sidebar-user{margin:16px 12px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.07);border-radius:var(--radius-md);padding:12px 14px;display:flex;align-items:center;gap:10px}
.user-avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--blue-royal),var(--green-neon));display:flex;align-items:center;justify-content:center;font-size:15px;font-weight:700;flex-shrink:0}
.user-info{flex:1;min-width:0}
.user-info strong{display:block;font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.user-info span{font-size:11px;color:var(--green-neon);font-weight:500}
.sidebar-nav{flex:1;overflow-y:auto;padding:8px 0}
.sidebar-nav::-webkit-scrollbar{width:4px}
.sidebar-nav::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:2px}
.nav-section-label{font-size:9px;font-weight:700;letter-spacing:.14em;text-transform:uppercase;color:var(--gray-600);padding:16px 20px 6px}
.nav-item{display:flex;align-items:center;gap:12px;padding:11px 16px;margin:1px 8px;border-radius:var(--radius-sm);cursor:pointer;transition:var(--transition);font-size:14px;font-weight:500;color:var(--gray-400);position:relative;text-decoration:none;border:1px solid transparent}
.nav-item i{width:20px;text-align:center;font-size:15px;flex-shrink:0}
.nav-item:hover{background:rgba(255,255,255,0.05);color:var(--white);border-color:rgba(255,255,255,0.06)}
.nav-item.active{background:linear-gradient(135deg,rgba(26,26,255,0.3),rgba(0,255,136,0.08));color:white;border-color:rgba(26,26,255,0.4)}
.nav-item.active i{color:var(--green-neon)}
.nav-item .badge{margin-left:auto;background:var(--blue-royal);color:white;font-size:10px;font-weight:700;padding:2px 7px;border-radius:100px;font-family:'JetBrains Mono',monospace}
.sidebar-footer{padding:12px 8px;border-top:1px solid rgba(255,255,255,0.06)}
.btn-logout{display:flex;align-items:center;gap:10px;width:100%;padding:11px 16px;background:rgba(255,68,102,0.08);border:1px solid rgba(255,68,102,0.2);border-radius:var(--radius-sm);color:#FF7799;font-family:'Outfit',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:var(--transition)}
.btn-logout:hover{background:rgba(255,68,102,0.18);border-color:rgba(255,68,102,0.4)}

/* MAIN */
.main-area{flex:1;margin-left:var(--sidebar-w);display:flex;flex-direction:column;min-height:100vh}
.topbar{height:var(--topbar-h);background:rgba(8,8,26,0.85);backdrop-filter:blur(20px);border-bottom:1px solid rgba(255,255,255,0.06);display:flex;align-items:center;padding:0 28px;gap:16px;position:sticky;top:0;z-index:50}
.topbar-title{flex:1;font-size:18px;font-weight:700;letter-spacing:-.3px}
.topbar-title span{color:var(--green-neon)}
.topbar-actions{display:flex;align-items:center;gap:10px}
.topbar-btn{width:38px;height:38px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;color:var(--gray-400);cursor:pointer;transition:var(--transition);font-size:15px}
.topbar-btn:hover{background:rgba(255,255,255,0.1);color:white}
.hamburger{display:none;background:none;border:none;color:white;font-size:20px;cursor:pointer;padding:8px}

/* PAGES */
.page-content{flex:1;padding:28px;display:none;animation:fadeIn .35s ease}
.page-content.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}

/* STATS */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:28px}
.stat-card{background:linear-gradient(135deg,rgba(255,255,255,0.04) 0%,rgba(255,255,255,0.01) 100%);border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius-lg);padding:22px;position:relative;overflow:hidden;transition:var(--transition)}
.stat-card:hover{transform:translateY(-3px);border-color:rgba(255,255,255,0.15)}
.stat-card.blue::before{background:var(--blue-royal)}
.stat-card.green::before{background:var(--green-neon)}
.stat-card.orange::before{background:var(--warning)}
.stat-card.red::before{background:var(--danger)}
.stat-card::before{content:'';position:absolute;top:-40px;right:-40px;width:120px;height:120px;border-radius:50%;opacity:.08}
.stat-icon{width:44px;height:44px;border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-size:18px;margin-bottom:14px}
.stat-card.blue .stat-icon{background:rgba(26,26,255,0.2);color:var(--blue-light)}
.stat-card.green .stat-icon{background:rgba(0,255,136,0.15);color:var(--green-neon)}
.stat-card.orange .stat-icon{background:rgba(255,170,0,0.15);color:var(--warning)}
.stat-card.red .stat-icon{background:rgba(255,68,102,0.15);color:var(--danger)}
.stat-value{font-size:32px;font-weight:800;letter-spacing:-1px;font-family:'JetBrains Mono',monospace}
.stat-label{font-size:13px;color:var(--gray-400);margin-top:4px;font-weight:500}
.stat-change{margin-top:10px;font-size:12px;font-weight:600;display:flex;align-items:center;gap:5px}
.stat-change.up{color:var(--green-neon)}

/* PANELS */
.panel-section{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.07);border-radius:var(--radius-lg);overflow:hidden;margin-bottom:20px}
.panel-header{padding:18px 22px;border-bottom:1px solid rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:space-between}
.panel-header h3{font-size:16px;font-weight:700;display:flex;align-items:center;gap:10px}
.panel-header h3 i{color:var(--green-neon);font-size:15px}
.panel-body{padding:22px}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 18px;border:none;border-radius:var(--radius-sm);font-family:'Outfit',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:var(--transition);text-decoration:none}
.btn-primary{background:linear-gradient(135deg,var(--blue-royal),var(--blue-bright));color:white;box-shadow:var(--shadow-sm)}
.btn-primary:hover{transform:translateY(-1px);box-shadow:var(--shadow-md)}
.btn-success{background:linear-gradient(135deg,var(--green-mid),#00AA55);color:white}
.btn-danger{background:rgba(255,68,102,0.12);border:1px solid rgba(255,68,102,0.3);color:#FF7799}
.btn-danger:hover{background:rgba(255,68,102,0.22)}
.btn-ghost{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);color:var(--gray-400)}
.btn-ghost:hover{background:rgba(255,255,255,0.1);color:white}
.btn-sm{padding:7px 13px;font-size:12px}

/* FORMS */
.field-group{margin-bottom:20px}
.field-label{display:block;font-size:12px;font-weight:700;color:var(--gray-400);letter-spacing:.07em;text-transform:uppercase;margin-bottom:8px}
.field-input,.field-textarea,.field-select{width:100%;padding:12px 16px;background:rgba(255,255,255,0.05);border:1.5px solid rgba(255,255,255,0.1);border-radius:var(--radius-sm);color:white;font-family:'Outfit',sans-serif;font-size:14px;outline:none;transition:var(--transition)}
.field-input::placeholder,.field-textarea::placeholder{color:var(--gray-600)}
.field-input:focus,.field-textarea:focus,.field-select:focus{border-color:var(--blue-bright);background:rgba(61,61,255,0.08);box-shadow:0 0 0 4px rgba(61,61,255,0.1)}
.field-textarea{resize:vertical;min-height:100px;line-height:1.6}
.field-select{cursor:pointer}
.field-select option{background:var(--dark-3);color:white}
.field-row{display:grid;grid-template-columns:1fr 1fr;gap:16px}

/* TABLE */
.data-table{width:100%;border-collapse:collapse;font-size:13.5px}
.data-table th{text-align:left;padding:10px 16px;font-size:11px;font-weight:700;letter-spacing:.09em;text-transform:uppercase;color:var(--gray-400);border-bottom:1px solid rgba(255,255,255,0.06)}
.data-table td{padding:13px 16px;border-bottom:1px solid rgba(255,255,255,0.04);vertical-align:middle}
.data-table tr:last-child td{border-bottom:none}
.data-table tr:hover td{background:rgba(255,255,255,0.02)}
.badge-pill{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;border-radius:100px;font-size:11px;font-weight:600;letter-spacing:.03em}
.badge-blue{background:rgba(26,26,255,0.2);color:var(--blue-light)}
.badge-green{background:rgba(0,255,136,0.15);color:var(--green-neon)}
.badge-orange{background:rgba(255,170,0,0.15);color:var(--warning)}
.badge-red{background:rgba(255,68,102,0.15);color:var(--danger)}
.badge-gray{background:rgba(255,255,255,0.08);color:var(--gray-400)}
.badge-teal{background:rgba(0,200,180,0.15);color:#00C8B4}
.mini-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--blue-royal),var(--green-neon));display:inline-flex;align-items:center;justify-content:center;font-size:13px;font-weight:700}

/* MODAL */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.75);backdrop-filter:blur(8px);z-index:200;align-items:center;justify-content:center;padding:20px}
.modal-overlay.open{display:flex;animation:fadeOverlay .2s ease}
@keyframes fadeOverlay{from{opacity:0}to{opacity:1}}
.modal{background:var(--dark-3);border:1px solid rgba(255,255,255,0.1);border-radius:var(--radius-xl);width:100%;max-width:520px;max-height:90vh;overflow-y:auto;animation:modalSlide .35s cubic-bezier(0.16,1,0.3,1)}
@keyframes modalSlide{from{opacity:0;transform:scale(.95) translateY(20px)}to{opacity:1;transform:none}}
.modal-header{padding:24px 28px 20px;border-bottom:1px solid rgba(255,255,255,0.07);display:flex;align-items:center;justify-content:space-between}
.modal-header h3{font-size:18px;font-weight:700}
.modal-close{width:32px;height:32px;border-radius:var(--radius-sm);background:rgba(255,255,255,0.06);border:none;color:var(--gray-400);cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:var(--transition)}
.modal-close:hover{background:rgba(255,68,102,0.2);color:var(--danger)}
.modal-body{padding:24px 28px}
.modal-footer{padding:18px 28px;border-top:1px solid rgba(255,255,255,0.07);display:flex;gap:10px;justify-content:flex-end}

/* TOAST */
.toast-container{position:fixed;top:20px;right:20px;z-index:9999;display:flex;flex-direction:column;gap:10px}
.toast{background:var(--dark-3);border:1px solid rgba(255,255,255,0.1);border-radius:var(--radius-md);padding:14px 18px;display:flex;align-items:center;gap:12px;min-width:280px;max-width:360px;box-shadow:var(--shadow-lg);animation:toastIn .4s cubic-bezier(0.16,1,0.3,1)}
@keyframes toastIn{from{opacity:0;transform:translateX(40px)}to{opacity:1;transform:none}}
.toast i{font-size:18px}
.toast.success i{color:var(--green-neon)}
.toast.error i{color:var(--danger)}
.toast.info i{color:var(--blue-light)}
.toast-text strong{display:block;font-size:14px;font-weight:600}
.toast-text span{font-size:12px;color:var(--gray-400)}

/* SUB TABS */
.section-tabs{display:flex;gap:6px;margin-bottom:24px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.07);border-radius:var(--radius-md);padding:6px}
.section-tab{flex:1;padding:10px 14px;background:none;border:none;color:var(--gray-400);font-family:'Outfit',sans-serif;font-size:13px;font-weight:600;cursor:pointer;border-radius:var(--radius-sm);transition:var(--transition);text-align:center}
.section-tab.active{background:linear-gradient(135deg,rgba(26,26,255,0.35),rgba(0,255,136,0.1));color:white;border:1px solid rgba(26,26,255,0.3)}
.page-section-editor{display:none}
.page-section-editor.active{display:block}
.divider{height:1px;background:rgba(255,255,255,0.06);margin:20px 0}
.toggle-wrap{display:flex;align-items:center;justify-content:space-between;padding:14px 0;border-bottom:1px solid rgba(255,255,255,0.05)}
.toggle-wrap:last-child{border-bottom:none}
.toggle-info strong{display:block;font-size:14px;font-weight:600}
.toggle-info span{font-size:12px;color:var(--gray-400)}
.toggle{position:relative;width:46px;height:24px;cursor:pointer}
.toggle input{opacity:0;width:0;height:0}
.toggle-track{position:absolute;inset:0;background:rgba(255,255,255,0.1);border-radius:100px;transition:var(--transition)}
.toggle input:checked + .toggle-track{background:linear-gradient(135deg,var(--blue-royal),var(--green-mid))}
.toggle-thumb{position:absolute;left:3px;top:3px;width:18px;height:18px;border-radius:50%;background:white;transition:var(--transition);box-shadow:0 1px 4px rgba(0,0,0,0.3)}
.toggle input:checked ~ .toggle-thumb{transform:translateX(22px)}
.upload-zone{border:2px dashed rgba(255,255,255,0.15);border-radius:var(--radius-md);padding:32px;text-align:center;cursor:pointer;transition:var(--transition);background:rgba(255,255,255,0.02)}
.upload-zone:hover{border-color:var(--blue-bright);background:rgba(61,61,255,0.06)}
.upload-zone i{font-size:32px;color:var(--gray-600);margin-bottom:12px;display:block}
.upload-zone p{font-size:13px;color:var(--gray-400);line-height:1.5}

/* Firebase status badge */
.fb-status{display:inline-flex;align-items:center;gap:6px;font-size:11px;font-weight:600;padding:4px 10px;border-radius:100px;background:rgba(0,255,136,0.1);color:var(--green-neon);border:1px solid rgba(0,255,136,0.2)}
.fb-status.disconnected{background:rgba(255,68,102,0.1);color:#FF7799;border-color:rgba(255,68,102,0.2)}
.fb-dot{width:6px;height:6px;border-radius:50%;background:currentColor;animation:blink 1.5s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}

/* PASSWORD TOGGLE */
.pass-wrap{position:relative}
.pass-wrap .field-input{padding-right:44px}
.pass-wrap .pass-toggle{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--gray-400);cursor:pointer;padding:4px;font-size:15px;transition:color .2s;line-height:1}
.pass-wrap .pass-toggle:hover{color:var(--green-neon)}

/* LOGIN pass toggle ‚Äî input tiene icono izquierdo, el ojo va a la derecha */
.input-wrap{position:relative}
.input-wrap .pass-toggle{position:absolute;right:14px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--gray-400);cursor:pointer;padding:4px;font-size:14px;transition:color .2s;line-height:1;z-index:2}
.input-wrap .pass-toggle:hover{color:var(--green-neon)}
/* Asegurar que el input no quede cubierto por el ojo */
.input-wrap .form-input{padding-right:46px}

/* USER CATEGORY CARDS */
.user-cat-card{padding:14px 16px;background:rgba(255,255,255,0.03);border:1.5px solid rgba(255,255,255,0.08);border-radius:var(--radius-md);cursor:pointer;transition:all .25s;user-select:none}
.user-cat-card:hover{border-color:rgba(107,107,255,0.4);background:rgba(107,107,255,0.07)}
.user-cat-card.active{border-color:var(--blue-bright);background:rgba(61,61,255,0.12);box-shadow:0 0 0 1px var(--blue-bright)}

/* RESPONSIVE */
@media(max-width:1024px){:root{--sidebar-w:220px}}
@media(max-width:768px){
  .sidebar{transform:translateX(-100%);width:280px}
  .sidebar.open{transform:translateX(0)}
  .main-area{margin-left:0}
  .topbar{padding:0 16px}
  .page-content{padding:16px}
  .stats-grid{grid-template-columns:1fr 1fr}
  .field-row{grid-template-columns:1fr}
  .hamburger{display:block}
}
@media(max-width:480px){.stats-grid{grid-template-columns:1fr}.stat-value{font-size:26px}}
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:3px}
.sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:99}
.sidebar-overlay.open{display:block}
</style>
</head>
<body>

<!-- Funci√≥n global de toggle contrase√±a ‚Äî disponible desde el inicio -->
<script>
function togglePass(inputId, btn){
  const input = document.getElementById(inputId);
  if(!input) return;
  const show = input.type === 'password';
  input.type = show ? 'text' : 'password';
  const icon = btn.querySelector('i');
  if(icon) icon.className = show ? 'fas fa-eye-slash' : 'fas fa-eye';
}
</script>

<!-- LOGIN -->
<div id="loginScreen">
  <div class="login-bg"></div>
  <div class="login-orbs"><div class="orb orb-1"></div><div class="orb orb-2"></div><div class="orb orb-3"></div></div>
  <div class="login-card">
    <div class="login-logo">
      <div class="logo-icon"><i class="fas fa-bolt"></i></div>
      <h1>Adrian Creativo</h1>
      <p>Panel de Administraci√≥n</p>
    </div>
    <div class="login-tabs">
      <button class="login-tab active" onclick="setTab('admin')">Administrador</button>
      <button class="login-tab" onclick="setTab('user')">Usuario</button>
    </div>
    <div class="form-group">
      <label class="form-label">Usuario</label>
      <div class="input-wrap">
        <input type="text" class="form-input" id="loginUser" placeholder="Ingresa tu usuario">
        <i class="fas fa-user"></i>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Contrase√±a</label>
      <div class="input-wrap">
        <input type="password" class="form-input" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeyup="if(event.key==='Enter')doLogin()">
        <i class="fas fa-lock"></i>
        <button type="button" class="pass-toggle" onclick="togglePass('loginPass',this)" tabindex="-1"><i class="fas fa-eye"></i></button>
      </div>
    </div>
    <button class="btn-login" onclick="doLogin()"><i class="fas fa-sign-in-alt"></i> Acceder al Sistema</button>
    <div class="login-error" id="loginError"><i class="fas fa-exclamation-circle"></i> <span id="loginErrorMsg">Usuario o contrase√±a incorrectos</span></div>
  </div>
</div>

<!-- APP -->
<div id="appShell">
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo"><i class="fas fa-bolt"></i></div>
      <div class="sidebar-brand"><h2>Adrian Creativo</h2><span>Panel Admin</span></div>
    </div>
    <div class="sidebar-user">
      <div class="user-avatar" id="sidebarAvatar">A</div>
      <div class="user-info"><strong id="sidebarName">Adrian</strong><span id="sidebarRole">Superusuario</span></div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-section-label">General</div>
      <a class="nav-item active" onclick="navigate('dashboard')"><i class="fas fa-th-large"></i> Dashboard</a>
      <div class="nav-section-label">Contenido del Sitio</div>
      <a class="nav-item" id="nav-home" onclick="navigate('pageHome')"><i class="fas fa-home"></i> P√°gina de Inicio</a>
      <a class="nav-item" id="nav-about" onclick="navigate('pageAbout')"><i class="fas fa-user-circle"></i> Acerca de Nosotros</a>
      <a class="nav-item" id="nav-contact" onclick="navigate('pageContact')"><i class="fas fa-envelope"></i> Cont√°ctanos</a>
      <a class="nav-item" id="nav-projects" onclick="navigate('pageProjects')"><i class="fas fa-layer-group"></i> Proyectos</a>
      <div class="nav-section-label">Educaci√≥n</div>
      <a class="nav-item" id="nav-courses" onclick="navigate('pageCourses')"><i class="fas fa-graduation-cap"></i> Cursos <span class="badge" id="coursesBadge">0</span></a>
      <a class="nav-item" id="nav-playlists" onclick="navigate('pagePlaylists')"><i class="fas fa-list-ul"></i> Playlists</a>
      <div class="nav-section-label" id="nav-admin-label" style="display:none">Administraci√≥n</div>
      <a class="nav-item" id="nav-users" onclick="navigate('pageUsers')" style="display:none"><i class="fas fa-users"></i> Usuarios</a>
      <a class="nav-item" id="nav-settings" onclick="navigate('pageSettings')"><i class="fas fa-sliders-h"></i> Configuraci√≥n</a>
    </nav>
    <div class="sidebar-footer">
      <button class="btn-logout" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n</button>
    </div>
  </aside>

  <div class="main-area">
    <header class="topbar">
      <button class="hamburger" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
      <div class="topbar-title" id="topbarTitle">Dashboard <span>/ Inicio</span></div>
      <div class="topbar-actions">
        <span id="fbStatusBadge" class="fb-status disconnected"><span class="fb-dot"></span> Conectando...</span>
        <button class="topbar-btn" onclick="navigate('pageSettings')"><i class="fas fa-cog"></i></button>
      </div>
    </header>

    <!-- DASHBOARD -->
    <div class="page-content active" id="page-dashboard">
      <div class="stats-grid">
        <div class="stat-card blue"><div class="stat-icon"><i class="fas fa-graduation-cap"></i></div><div class="stat-value" id="statCourses">‚Äî</div><div class="stat-label">Cursos Publicados</div><div class="stat-change up"><i class="fas fa-check"></i> Activos</div></div>
        <div class="stat-card green"><div class="stat-icon"><i class="fas fa-users"></i></div><div class="stat-value" id="statUsers">‚Äî</div><div class="stat-label">Usuarios Registrados</div><div class="stat-change up"><i class="fas fa-arrow-up"></i> Activos</div></div>
        <div class="stat-card orange"><div class="stat-icon"><i class="fas fa-layer-group"></i></div><div class="stat-value" id="statProjects">‚Äî</div><div class="stat-label">Proyectos</div><div class="stat-change up"><i class="fas fa-check"></i> Actualizados</div></div>
        <div class="stat-card red"><div class="stat-icon"><i class="fas fa-eye"></i></div><div class="stat-value">‚Äî</div><div class="stat-label">Visitas Totales</div><div class="stat-change" style="color:var(--gray-400)"><i class="fas fa-chart-line"></i> Conecta analytics</div></div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
        <div class="panel-section">
          <div class="panel-header"><h3><i class="fas fa-bolt"></i> Acceso R√°pido</h3></div>
          <div class="panel-body" style="display:flex;flex-direction:column;gap:10px">
            <button class="btn btn-primary" onclick="navigate('pageCourses')" style="justify-content:flex-start"><i class="fas fa-plus"></i> Agregar nuevo curso</button>
            <button class="btn btn-ghost" onclick="navigate('pageProjects')" style="justify-content:flex-start"><i class="fas fa-image"></i> Gestionar proyectos</button>
            <button class="btn btn-ghost" onclick="navigate('pageHome')" style="justify-content:flex-start"><i class="fas fa-edit"></i> Editar p√°gina principal</button>
            <button class="btn btn-ghost" id="quickUsers" onclick="navigate('pageUsers')" style="justify-content:flex-start;display:none"><i class="fas fa-user-plus"></i> Crear nuevo usuario</button>
          </div>
        </div>
        <div class="panel-section">
          <div class="panel-header"><h3><i class="fas fa-user-clock"></i> Usuarios Recientes</h3><button class="btn btn-sm btn-ghost" id="quickUsersBtn2" onclick="navigate('pageUsers')" style="display:none"><i class="fas fa-arrow-right"></i></button></div>
          <div class="panel-body" style="padding:0">
            <div id="dashRecentUsers" style="display:flex;flex-direction:column"></div>
          </div>
        </div>
      </div>
      <div style="margin-top:20px">
        <div class="panel-section">
          <div class="panel-header"><h3><i class="fas fa-info-circle"></i> Estado del Sitio</h3></div>
          <div class="panel-body">
            <div class="toggle-wrap"><div class="toggle-info"><strong>Sitio Web en L√≠nea</strong><span>Visible para visitantes</span></div><label class="toggle"><input type="checkbox" checked><div class="toggle-track"></div><div class="toggle-thumb"></div></label></div>
            <div class="toggle-wrap"><div class="toggle-info"><strong>Secci√≥n Cursos</strong><span>Mostrar cat√°logo</span></div><label class="toggle"><input type="checkbox" checked><div class="toggle-track"></div><div class="toggle-thumb"></div></label></div>
            <div class="toggle-wrap"><div class="toggle-info"><strong>Modo Mantenimiento</strong><span>Ocultar el sitio</span></div><label class="toggle"><input type="checkbox"><div class="toggle-track"></div><div class="toggle-thumb"></div></label></div>
          </div>
        </div>
      </div>
    </div>

    <!-- INICIO -->
    <div class="page-content" id="page-pageHome">
      <div class="section-tabs">
        <button class="section-tab active" onclick="switchSubTab(this,'home-hero')">Hero / Banner</button>
        <button class="section-tab" onclick="switchSubTab(this,'home-images')">üñºÔ∏è Im√°genes</button>
        <button class="section-tab" onclick="switchSubTab(this,'home-meta')">SEO / Meta</button>
      </div>
      <div class="page-section-editor active" id="home-hero">
        <div class="panel-section">
          <div class="panel-header"><h3><i class="fas fa-image"></i> Secci√≥n Hero (Inicio)</h3><button class="btn btn-sm btn-primary" onclick="saveSection('hero')"><i class="fas fa-save"></i> Guardar en Firebase</button></div>
          <div class="panel-body">
            <div class="field-row">
              <div class="field-group"><label class="field-label">L√≠nea 1 del t√≠tulo</label><input type="text" class="field-input" id="hero-line1" placeholder="Creatividad"></div>
              <div class="field-group"><label class="field-label">L√≠nea 2 del t√≠tulo</label><input type="text" class="field-input" id="hero-line2" placeholder="Sin L√≠mites."></div>
            </div>
            <div class="field-group"><label class="field-label">L√≠nea 3 (subt√≠tulo del t√≠tulo)</label><input type="text" class="field-input" id="hero-line3" placeholder="Tu visi√≥n, hecha realidad."></div>
            <div class="field-group"><label class="field-label">P√°rrafo descriptivo</label><textarea class="field-textarea" id="hero-sub" style="min-height:90px" placeholder="Somos una agencia creativa que combina..."></textarea></div>
            <div class="field-row">
              <div class="field-group"><label class="field-label">Texto Bot√≥n 1 (CTA primario)</label><input type="text" class="field-input" id="hero-btn1" placeholder="Cont√°ctanos"></div>
              <div class="field-group"><label class="field-label">Texto Bot√≥n 2 (CTA secundario)</label><input type="text" class="field-input" id="hero-btn2" placeholder="Acerca de Nosotros"></div>
            </div>
            <div style="background:rgba(0,255,136,0.05);border:1px solid rgba(0,255,136,0.15);border-radius:var(--radius-sm);padding:12px 14px;font-size:12px;color:var(--gray-400);margin-top:4px">
              <i class="fas fa-info-circle" style="color:var(--green-neon)"></i> Los campos vac√≠os conservar√°n el texto actual del sitio. Rellena solo lo que quieras cambiar.
            </div>
          </div>
        </div>
      </div>
      <div class="page-section-editor" id="home-images">
        <div class="panel-section">
          <div class="panel-header"><h3><i class="fas fa-cloud-upload-alt"></i> Im√°genes del Sitio (Cloudinary)</h3><button class="btn btn-sm btn-primary" onclick="saveSection('images')"><i class="fas fa-save"></i> Guardar en Firebase</button></div>
          <div class="panel-body">
            <div style="background:rgba(61,61,255,0.07);border:1px solid rgba(61,61,255,0.2);border-radius:var(--radius-sm);padding:14px;margin-bottom:20px;font-size:12.5px;color:var(--gray-400);line-height:1.7">
              <i class="fas fa-lightbulb" style="color:#FFAA00;margin-right:6px"></i>
              <strong style="color:white">C√≥mo usar Cloudinary:</strong> Entra a <strong style="color:var(--blue-light)">cloudinary.com</strong> ‚Üí Media Library ‚Üí sube tu imagen ‚Üí clic en la imagen ‚Üí "Copy URL". Pega la URL aqu√≠.
            </div>
            <div class="field-group">
              <label class="field-label"><i class="fas fa-mountain" style="color:var(--blue-glow)"></i> Foto de fondo del Hero (foto principal)</label>
              <input type="url" class="field-input" id="img-hero" placeholder="https://res.cloudinary.com/tu-cuenta/image/upload/v.../foto.jpg">
              <div style="font-size:11px;color:var(--gray-600);margin-top:5px">Se muestra como fondo en el banner principal de la p√°gina de inicio. Recomendado: 1920√ó1080px.</div>
            </div>
            <div class="field-group" style="margin-top:16px">
              <label class="field-label"><i class="fas fa-user-circle" style="color:var(--green-neon)"></i> Foto de perfil (secci√≥n Acerca de)</label>
              <input type="url" class="field-input" id="img-about" placeholder="https://res.cloudinary.com/tu-cuenta/image/upload/v.../perfil.jpg">
              <div style="font-size:11px;color:var(--gray-600);margin-top:5px">Foto que aparece en la secci√≥n "Acerca de Nosotros". Recomendado: cuadrada, m√≠nimo 600√ó600px.</div>
            </div>
            <div class="field-group" style="margin-top:16px">
              <label class="field-label"><i class="fas fa-layer-group" style="color:#FFB347"></i> Logo del sitio (barra de navegaci√≥n)</label>
              <input type="url" class="field-input" id="img-logo" placeholder="https://res.cloudinary.com/tu-cuenta/image/upload/v.../logo.png">
              <div style="font-size:11px;color:var(--gray-600);margin-top:5px">Opcional ‚Äî si se deja vac√≠o se usar√° el √≠cono de rayo por defecto. Recomendado: PNG transparente.</div>
            </div>
            <!-- Preview strip -->
            <div id="imgPreviewStrip" style="display:flex;gap:14px;flex-wrap:wrap;margin-top:20px;padding-top:20px;border-top:1px solid rgba(255,255,255,0.06)">
              <div style="font-size:12px;color:var(--gray-500);width:100%;margin-bottom:4px"><i class="fas fa-eye"></i> Vista previa</div>
            </div>
          </div>
        </div>
      </div>
      <div class="page-section-editor" id="home-meta">
        <div class="panel-section">
          <div class="panel-header"><h3><i class="fas fa-search"></i> SEO y Metadatos</h3><button class="btn btn-sm btn-primary" onclick="saveSection('meta')"><i class="fas fa-save"></i> Guardar en Firebase</button></div>
          <div class="panel-body">
            <div class="field-group"><label class="field-label">T√≠tulo de la p√°gina (pesta√±a del navegador)</label><input type="text" class="field-input" id="meta-title" placeholder="Adrian Creativo ¬∑ Dise√±o, AI y Cursos"></div>
            <div class="field-group"><label class="field-label">Meta descripci√≥n (para Google)</label><textarea class="field-textarea" id="meta-desc" style="min-height:70px" placeholder="Agencia creativa especializada en dise√±o, IA y video."></textarea></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ACERCA DE -->
    <div class="page-content" id="page-pageAbout">
      <div class="panel-section">
        <div class="panel-header"><h3><i class="fas fa-user-circle"></i> Acerca de Nosotros</h3><button class="btn btn-sm btn-primary" onclick="saveSection('about')"><i class="fas fa-save"></i> Guardar en Firebase</button></div>
        <div class="panel-body">
          <div class="field-group"><label class="field-label">Descripci√≥n principal</label><textarea class="field-textarea" id="about-desc" style="min-height:140px" placeholder="Somos una agencia creativa digital especializada en..."></textarea></div>
          <div class="field-row">
            <div class="field-group"><label class="field-label">A√±os de experiencia (badge)</label><input type="text" class="field-input" id="about-years" placeholder="3+"></div>
            <div class="field-group"><label class="field-label">Etiqueta del badge</label><input type="text" class="field-input" id="about-years-label" placeholder="A√±os de experiencia"></div>
          </div>
          <div class="field-row">
            <div class="field-group"><label class="field-label">M√©trica 1 (n√∫mero)</label><input type="text" class="field-input" id="about-m1-num" placeholder="50+"></div>
            <div class="field-group"><label class="field-label">M√©trica 1 (etiqueta)</label><input type="text" class="field-input" id="about-m1-label" placeholder="Proyectos"></div>
          </div>
          <div class="field-row">
            <div class="field-group"><label class="field-label">M√©trica 2 (n√∫mero)</label><input type="text" class="field-input" id="about-m2-num" placeholder="3"></div>
            <div class="field-group"><label class="field-label">M√©trica 2 (etiqueta)</label><input type="text" class="field-input" id="about-m2-label" placeholder="Cursos"></div>
          </div>
          <div class="field-row">
            <div class="field-group"><label class="field-label">M√©trica 3 (n√∫mero)</label><input type="text" class="field-input" id="about-m3-num" placeholder="100%"></div>
            <div class="field-group"><label class="field-label">M√©trica 3 (etiqueta)</label><input type="text" class="field-input" id="about-m3-label" placeholder="Pasi√≥n"></div>
          </div>
          <div style="border-top:1px solid rgba(255,255,255,0.06);margin-top:20px;padding-top:20px">
            <label class="field-label"><i class="fas fa-user-circle" style="color:var(--green-neon)"></i> Foto de perfil (Cloudinary URL)</label>
            <input type="url" class="field-input" id="about-img" placeholder="https://res.cloudinary.com/tu-cuenta/image/upload/...">
            <div style="font-size:11px;color:var(--gray-600);margin-top:5px">Se muestra en la secci√≥n "Acerca de Nosotros". Tambi√©n puedes actualizarla desde <strong style="color:var(--gray-400)">Inicio ‚Üí Im√°genes</strong>.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- CONTACTO -->
    <div class="page-content" id="page-pageContact">
      <div class="panel-section">
        <div class="panel-header"><h3><i class="fas fa-share-alt"></i> Secci√≥n Cont√°ctanos</h3><button class="btn btn-sm btn-primary" onclick="saveSection('contact')"><i class="fas fa-save"></i> Guardar en Firebase</button></div>
        <div class="panel-body">
          <div class="field-group"><label class="field-label">Subt√≠tulo de la secci√≥n</label><textarea class="field-textarea" id="contact-sub" style="min-height:60px" placeholder="¬øTienes un proyecto en mente? Estamos disponibles..."></textarea></div>
          <div class="divider"></div>
          <h4 style="font-size:13px;font-weight:700;margin-bottom:16px;color:var(--gray-400);letter-spacing:.08em;text-transform:uppercase">REDES SOCIALES</h4>
          <div class="field-row">
            <div class="field-group"><label class="field-label"><i class="fab fa-whatsapp" style="color:#25D366"></i> N√∫mero WhatsApp</label><input type="text" class="field-input" id="contact-wa" placeholder="50432513558 (solo n√∫meros, sin +)"></div>
            <div class="field-group"><label class="field-label">Mensaje WhatsApp</label><input type="text" class="field-input" id="contact-wa-msg" placeholder="¬°Hola! Me interesa saber m√°s..."></div>
          </div>
          <div class="field-row">
            <div class="field-group"><label class="field-label"><i class="fab fa-facebook" style="color:#1877F2"></i> Facebook (usuario)</label><input type="text" class="field-input" id="contact-fb" placeholder="AdrianCreativo"></div>
            <div class="field-group"><label class="field-label"><i class="fab fa-instagram" style="color:#E4405F"></i> Instagram (usuario)</label><input type="text" class="field-input" id="contact-ig" placeholder="adriancreativo"></div>
          </div>
          <div class="field-row">
            <div class="field-group"><label class="field-label"><i class="fab fa-tiktok"></i> TikTok (usuario)</label><input type="text" class="field-input" id="contact-tt" placeholder="adriancreativo"></div>
            <div class="field-group"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- PROYECTOS -->
    <div class="page-content" id="page-pageProjects">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
        <div><h2 style="font-size:20px;font-weight:800">Gesti√≥n de Proyectos</h2><p style="color:var(--gray-400);font-size:13px;margin-top:3px">AI ¬∑ PSD ¬∑ Video</p></div>
        <button class="btn btn-primary" onclick="openModal('modalProject')"><i class="fas fa-plus"></i> Nuevo Proyecto</button>
      </div>
      <div class="section-tabs">
        <button class="section-tab active" onclick="filterProjects('all',this)">Todos</button>
        <button class="section-tab" onclick="filterProjects('ai',this)">ü§ñ AI</button>
        <button class="section-tab" onclick="filterProjects('psd',this)">üé® PSD</button>
        <button class="section-tab" onclick="filterProjects('video',this)">üé¨ Video</button>
      </div>
      <div class="panel-section"><div class="panel-body" style="padding:0"><table class="data-table"><thead><tr><th>Proyecto</th><th>Categor√≠a</th><th>Estado</th><th>Acciones</th></tr></thead><tbody id="projectsBody"><tr><td colspan="4" style="text-align:center;padding:30px;color:var(--gray-400)"><i class="fas fa-spinner fa-spin"></i> Cargando desde Firebase...</td></tr></tbody></table></div></div>
    </div>

    <!-- CURSOS -->
    <div class="page-content" id="page-pageCourses">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
        <div><h2 style="font-size:20px;font-weight:800">Gesti√≥n de Cursos</h2><p style="color:var(--gray-400);font-size:13px;margin-top:3px">Crea y administra el cat√°logo</p></div>
        <button class="btn btn-primary" onclick="openModal('modalCourse')"><i class="fas fa-plus"></i> Nuevo Curso</button>
      </div>
      <div class="panel-section"><div class="panel-body" style="padding:0"><table class="data-table"><thead><tr><th>Curso</th><th>Categor√≠a</th><th>Precio</th><th>Estado</th><th>Acciones</th></tr></thead><tbody id="coursesBody"><tr><td colspan="5" style="text-align:center;padding:30px;color:var(--gray-400)"><i class="fas fa-spinner fa-spin"></i> Cargando desde Firebase...</td></tr></tbody></table></div></div>
    </div>

    <!-- PLAYLISTS -->
    <div class="page-content" id="page-pagePlaylists">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div><h2 style="font-size:20px;font-weight:800">Playlists de Cursos</h2><p style="color:var(--gray-400);font-size:13px;margin-top:3px">Gestiona los videos de cada curso</p></div>
        <button class="btn btn-primary" id="btnAddVideo" onclick="openAddVideo()" style="display:none"><i class="fas fa-plus"></i> Agregar Video</button>
      </div>
      <!-- Course selector -->
      <div style="margin-bottom:20px">
        <label class="field-label" style="margin-bottom:8px;display:block">Selecciona un curso para ver/editar su playlist</label>
        <select class="field-select" id="playlistCourseSelect" onchange="loadAdminPlaylist()" style="max-width:420px">
          <option value="">‚Äî Elige un curso ‚Äî</option>
        </select>
      </div>
      <!-- Playlist content -->
      <div id="playlistAdminContent" style="display:none">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px">
          <div id="playlistAdminTitle" style="font-size:15px;font-weight:700;color:var(--white)"></div>
          <div style="display:flex;gap:8px">
            <select class="field-select" id="plSectionFilter" onchange="filterPlaylistSection()" style="width:180px;font-size:13px">
              <option value="all">Todas las secciones</option>
            </select>
          </div>
        </div>
        <div class="panel-section"><div class="panel-body" style="padding:0">
          <table class="data-table">
            <thead><tr><th>#</th><th>T√≠tulo del Video</th><th>Secci√≥n</th><th>Duraci√≥n</th><th>URL</th><th>Acciones</th></tr></thead>
            <tbody id="playlistBody"><tr><td colspan="6" style="text-align:center;padding:24px;color:var(--gray-400)">Cargando...</td></tr></tbody>
          </table>
        </div></div>
      </div>
      <div id="playlistEmptyMsg" style="text-align:center;padding:60px 20px;color:var(--gray-500)">
        <i class="fas fa-list-ul" style="font-size:40px;opacity:.25;display:block;margin-bottom:12px"></i>
        <p>Selecciona un curso para ver su playlist</p>
      </div>
    </div>

    <!-- USUARIOS -->
    <div class="page-content" id="page-pageUsers">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
        <div><h2 style="font-size:20px;font-weight:800">Gesti√≥n de Usuarios</h2><p style="color:var(--gray-400);font-size:13px;margin-top:3px">Crea y gestiona niveles de acceso</p></div>
        <button class="btn btn-primary" onclick="openModal('modalUser')"><i class="fas fa-user-plus"></i> Nuevo Usuario</button>
      </div>
      <div class="panel-section"><div class="panel-body" style="padding:0"><table class="data-table"><thead><tr><th>Usuario</th><th>Categor√≠a / Rol</th><th>Estado</th><th>Registrado</th><th>Acciones</th></tr></thead><tbody id="usersBody"></tbody></table></div></div>
    </div>

    <!-- CONFIGURACION -->
    <div class="page-content" id="page-pageSettings">
      <div class="panel-section" style="max-width:640px">
        <div class="panel-header"><h3><i class="fas fa-fire"></i> Estado de Firebase</h3></div>
        <div class="panel-body">
          <div style="background:rgba(0,255,136,0.05);border:1px solid rgba(0,255,136,0.2);border-radius:var(--radius-md);padding:16px 18px;font-size:13px;color:var(--gray-400);line-height:1.8">
            <i class="fas fa-check-circle" style="color:var(--green-neon)"></i> <strong style="color:white">Firebase configurado</strong><br>
            Proyecto: <strong style="color:#fff">cursos-adrian-crea</strong><br>
            Base de datos: <strong style="color:#fff">Firestore</strong><br>
            <span style="color:var(--green-neon);font-size:12px">‚óè Conectado y sincronizando en tiempo real</span>
          </div>
        </div>
      </div>
      <div class="panel-section" style="max-width:640px">
        <div class="panel-header"><h3><i class="fas fa-lock"></i> Cambiar Contrase√±a</h3></div>
        <div class="panel-body">
          <div class="field-group"><label class="field-label">Contrase√±a actual</label>
            <div class="pass-wrap"><input type="password" class="field-input" id="oldPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"><button type="button" class="pass-toggle" onclick="togglePass('oldPass',this)" tabindex="-1"><i class="fas fa-eye"></i></button></div>
          </div>
          <div class="field-row">
            <div class="field-group"><label class="field-label">Nueva contrase√±a</label>
              <div class="pass-wrap"><input type="password" class="field-input" id="newPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"><button type="button" class="pass-toggle" onclick="togglePass('newPass',this)" tabindex="-1"><i class="fas fa-eye"></i></button></div>
            </div>
            <div class="field-group"><label class="field-label">Confirmar nueva</label>
              <div class="pass-wrap"><input type="password" class="field-input" id="confirmPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"><button type="button" class="pass-toggle" onclick="togglePass('confirmPass',this)" tabindex="-1"><i class="fas fa-eye"></i></button></div>
            </div>
          </div>
          <button class="btn btn-primary" onclick="changePassword()"><i class="fas fa-save"></i> Actualizar Contrase√±a</button>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- MODALES -->
<div class="modal-overlay" id="modalProject">
  <div class="modal">
    <div class="modal-header"><h3><i class="fas fa-layer-group" style="color:var(--green-neon);margin-right:8px"></i>Nuevo Proyecto</h3><button class="modal-close" onclick="closeModal('modalProject')"><i class="fas fa-times"></i></button></div>
    <div class="modal-body">
      <div class="field-group"><label class="field-label">Nombre del proyecto</label><input type="text" class="field-input" id="projName" placeholder="Ej: Identidad Visual Corporativa"></div>
      <div class="field-row">
        <div class="field-group"><label class="field-label">Categor√≠a</label><select class="field-select" id="projCat"><option value="ai">ü§ñ AI</option><option value="psd">üé® PSD</option><option value="video">üé¨ Video</option></select></div>
        <div class="field-group"><label class="field-label">Estado</label><select class="field-select" id="projStatus"><option value="published">Publicado</option><option value="draft">Borrador</option></select></div>
      </div>
      <div class="field-group"><label class="field-label">Descripci√≥n</label><textarea class="field-textarea" id="projDesc" placeholder="Breve descripci√≥n..."></textarea></div>
    </div>
    <div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal('modalProject')">Cancelar</button><button class="btn btn-primary" onclick="addProject()"><i class="fas fa-check"></i> Crear</button></div>
  </div>
</div>

<div class="modal-overlay" id="modalCourse">
  <div class="modal" style="max-width:620px">
    <div class="modal-header"><h3><i class="fas fa-graduation-cap" style="color:var(--green-neon);margin-right:8px"></i>Nuevo Curso</h3><button class="modal-close" onclick="closeModal('modalCourse')"><i class="fas fa-times"></i></button></div>
    <div class="modal-body">
      <div class="field-group"><label class="field-label">T√≠tulo del curso</label><input type="text" class="field-input" id="courseName" placeholder="Ej: Dise√±o con IA para Creativos"></div>
      <div class="field-row">
        <div class="field-group"><label class="field-label">Categor√≠a</label><select class="field-select" id="courseCat"><option value="ai">ü§ñ AI</option><option value="psd">üé® PSD</option><option value="video">üé¨ Video</option><option value="general">üìö General</option></select></div>
        <div class="field-group"><label class="field-label">Estado</label><select class="field-select" id="courseStatus"><option value="published">Publicado</option><option value="draft">Borrador</option><option value="coming">Pr√≥ximamente</option></select></div>
      </div>
      <div class="field-row">
        <div class="field-group"><label class="field-label">Precio</label><input type="number" class="field-input" id="coursePrice" placeholder="29.99" min="0" step="0.01"></div>
        <div class="field-group">
          <label class="field-label">Moneda</label>
          <input type="text" class="field-input" id="courseCurrency" placeholder="USD, HNL, MXN, EUR..." maxlength="10">
          <div style="font-size:11px;color:var(--gray-600);margin-top:4px">Escribe la moneda manualmente: USD, HNL, MXN, EUR, etc.</div>
        </div>
      </div>
      <div class="field-group"><label class="field-label">Descripci√≥n</label><textarea class="field-textarea" id="courseDesc" placeholder="¬øQu√© aprender√°n los estudiantes?"></textarea></div>
      <div class="field-row">
        <div class="field-group"><label class="field-label">Duraci√≥n total</label><input type="text" class="field-input" id="courseDur" placeholder="Ej: 8 horas"></div>
        <div class="field-group"><label class="field-label">Nivel</label><select class="field-select" id="courseLevel"><option value="beginner">Principiante</option><option value="intermediate">Intermedio</option><option value="advanced">Avanzado</option></select></div>
      </div>
      <div class="field-group"><label class="field-label">N√∫mero de lecciones</label><input type="number" class="field-input" id="courseLessons" placeholder="30" min="1"></div>
      <div class="field-group">
        <label class="field-label"><i class="fas fa-image" style="color:var(--green-neon)"></i> URL imagen de portada (Cloudinary)</label>
        <input type="url" class="field-input" id="courseImageUrl" placeholder="https://res.cloudinary.com/tu-cuenta/image/upload/...">
        <div style="font-size:11px;color:var(--gray-600);margin-top:4px"><i class="fas fa-info-circle"></i> Sube a <strong style="color:var(--gray-400)">cloudinary.com</strong> ‚Üí copia URL ‚Üí pega aqu√≠</div>
      </div>
      <div class="field-group">
        <label class="field-label"><i class="fas fa-video" style="color:var(--blue-light)"></i> URL video de presentaci√≥n (opcional)</label>
        <input type="url" class="field-input" id="courseVideoUrl" placeholder="YouTube o Cloudinary video URL">
      </div>
    </div>
    <div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal('modalCourse')">Cancelar</button><button class="btn btn-primary" onclick="addCourse()"><i class="fas fa-check"></i> Crear Curso</button></div>
  </div>
</div>

<div class="modal-overlay" id="modalUser">
  <div class="modal" style="max-width:620px">
    <div class="modal-header"><h3><i class="fas fa-user-plus" style="color:var(--green-neon);margin-right:8px"></i>Nuevo Usuario</h3><button class="modal-close" onclick="closeModal('modalUser')"><i class="fas fa-times"></i></button></div>
    <div class="modal-body">
      <!-- Datos b√°sicos -->
      <div class="field-row">
        <div class="field-group"><label class="field-label">Nombre completo</label><input type="text" class="field-input" id="userName" placeholder="Nombre del usuario"></div>
        <div class="field-group"><label class="field-label">Usuario (login)</label><input type="text" class="field-input" id="userLogin" placeholder="usuario123"></div>
      </div>
      <div class="field-row">
        <div class="field-group">
          <label class="field-label">Contrase√±a</label>
          <div class="pass-wrap">
            <input type="password" class="field-input" id="userPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <button type="button" class="pass-toggle" onclick="togglePass('userPass',this)" tabindex="-1"><i class="fas fa-eye"></i></button>
          </div>
        </div>
        <div class="field-group"><label class="field-label">Correo electr√≥nico</label><input type="email" class="field-input" id="userEmail" placeholder="correo@ejemplo.com"></div>
      </div>

      <!-- Categor√≠a de usuario -->
      <div class="field-group" style="margin-top:4px">
        <label class="field-label">Categor√≠a de usuario</label>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:6px">
          <div class="user-cat-card active" id="cat-admin-card" onclick="selectUserCategory('admin')">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px">
              <i class="fas fa-shield-alt" style="color:var(--blue-light);font-size:18px"></i>
              <strong style="font-size:14px">Panel Admin</strong>
            </div>
            <p style="font-size:12px;color:var(--gray-400);line-height:1.5">Accede al panel de administraci√≥n. T√∫ decides a qu√© secciones puede entrar.</p>
          </div>
          <div class="user-cat-card" id="cat-viewer-card" onclick="selectUserCategory('viewer')">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px">
              <i class="fas fa-play-circle" style="color:var(--green-neon);font-size:18px"></i>
              <strong style="font-size:14px">Estudiante</strong>
            </div>
            <p style="font-size:12px;color:var(--gray-400);line-height:1.5">Solo accede a la p√°gina de cursos para ver los videos asignados. Sin panel admin.</p>
          </div>
        </div>
        <input type="hidden" id="userCategory" value="admin">
      </div>

      <!-- Subcategor√≠a Admin -->
      <div id="adminSubWrap" style="margin-top:12px">
        <label class="field-label">Nivel de acceso en el panel</label>
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:6px">
          <label class="role-option-row" style="cursor:pointer;display:flex;align-items:flex-start;gap:10px;padding:10px 14px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius-sm);transition:border-color .2s">
            <input type="radio" name="userRole" value="admin" checked style="margin-top:2px;accent-color:var(--blue-bright)">
            <div><strong style="font-size:13px">‚öôÔ∏è Administrador</strong><br><span style="font-size:12px;color:var(--gray-500)">Acceso a cursos, proyectos, contenido y configuraci√≥n. Sin gesti√≥n de usuarios.</span></div>
          </label>
          <label class="role-option-row" style="cursor:pointer;display:flex;align-items:flex-start;gap:10px;padding:10px 14px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius-sm);transition:border-color .2s">
            <input type="radio" name="userRole" value="editor" style="margin-top:2px;accent-color:var(--blue-bright)">
            <div><strong style="font-size:13px">‚úèÔ∏è Editor</strong><br><span style="font-size:12px;color:var(--gray-500)">Solo puede editar cursos y proyectos. Sin acceso a configuraci√≥n ni usuarios.</span></div>
          </label>
        </div>
      </div>

      <!-- Subcategor√≠a Estudiante: playlists -->
      <div id="userPlaylistWrap" style="display:none;margin-top:12px">
        <div class="field-group">
          <label class="field-label"><i class="fas fa-list-ul" style="color:var(--green-neon)"></i> Playlists a las que tendr√° acceso</label>
          <div id="userPlaylistCheckboxes" style="display:flex;flex-direction:column;gap:8px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius-sm);padding:12px 14px;max-height:200px;overflow-y:auto;margin-top:6px">
            <div style="color:var(--gray-500);font-size:13px"><i class="fas fa-spinner fa-spin"></i> Cargando cursos...</div>
          </div>
          <div style="font-size:11px;color:var(--gray-600);margin-top:5px"><i class="fas fa-info-circle"></i> El usuario solo podr√° ver los videos de las playlists seleccionadas.</div>
        </div>
      </div>
    </div>
    <div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal('modalUser')">Cancelar</button><button class="btn btn-primary" onclick="addUser()"><i class="fas fa-check"></i> Crear Usuario</button></div>
  </div>
</div>

<!-- MODAL EDITAR USUARIO -->
<div class="modal-overlay" id="modalEditUser">
  <div class="modal" style="max-width:620px">
    <div class="modal-header"><h3><i class="fas fa-user-edit" style="color:var(--green-neon);margin-right:8px"></i>Editar Usuario</h3><button class="modal-close" onclick="closeModal('modalEditUser')"><i class="fas fa-times"></i></button></div>
    <div class="modal-body">
      <input type="hidden" id="editUserId">
      <!-- Datos b√°sicos -->
      <div class="field-row">
        <div class="field-group"><label class="field-label">Nombre completo</label><input type="text" class="field-input" id="editUserName" placeholder="Nombre del usuario"></div>
        <div class="field-group"><label class="field-label">Usuario (login)</label><input type="text" class="field-input" id="editUserLogin" placeholder="usuario123"></div>
      </div>
      <div class="field-row">
        <div class="field-group"><label class="field-label">Correo electr√≥nico</label><input type="email" class="field-input" id="editUserEmail" placeholder="correo@ejemplo.com"></div>
        <div class="field-group">
          <label class="field-label">Estado</label>
          <select class="field-select" id="editUserActive">
            <option value="true">‚óè Activo</option>
            <option value="false">‚óè Inactivo</option>
          </select>
        </div>
      </div>

      <!-- Contrase√±a -->
      <div class="field-row">
        <div class="field-group">
          <label class="field-label">Nueva contrase√±a <span style="font-size:10px;color:var(--gray-600)">(vac√≠o = no cambiar)</span></label>
          <div class="pass-wrap">
            <input type="password" class="field-input" id="editUserPass" placeholder="Nueva contrase√±a o dejar vac√≠o">
            <button type="button" class="pass-toggle" onclick="togglePass('editUserPass',this)" tabindex="-1"><i class="fas fa-eye"></i></button>
          </div>
        </div>
        <div class="field-group">
          <label class="field-label">Contrase√±a actual guardada</label>
          <div style="display:flex;gap:8px;align-items:center">
            <div id="editUserPassDisplay" style="flex:1;font-family:'JetBrains Mono',monospace;font-size:13px;color:var(--gray-400);letter-spacing:2px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius-sm);padding:10px 12px">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
            <button type="button" class="btn btn-sm btn-ghost" onclick="togglePassDisplay()" id="btnRevealPass" style="white-space:nowrap;flex-shrink:0"><i class="fas fa-eye"></i> Ver</button>
          </div>
        </div>
      </div>

      <!-- Categor√≠a -->
      <div class="field-group" style="margin-top:4px">
        <label class="field-label">Categor√≠a de usuario</label>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:6px">
          <div class="user-cat-card" id="editCat-admin-card" onclick="selectEditUserCategory('admin')">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px">
              <i class="fas fa-shield-alt" style="color:var(--blue-light);font-size:18px"></i>
              <strong style="font-size:14px">Panel Admin</strong>
            </div>
            <p style="font-size:12px;color:var(--gray-400);line-height:1.5">Accede al panel de administraci√≥n con el nivel de acceso asignado.</p>
          </div>
          <div class="user-cat-card" id="editCat-viewer-card" onclick="selectEditUserCategory('viewer')">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px">
              <i class="fas fa-play-circle" style="color:var(--green-neon);font-size:18px"></i>
              <strong style="font-size:14px">Estudiante</strong>
            </div>
            <p style="font-size:12px;color:var(--gray-400);line-height:1.5">Solo accede a la p√°gina de cursos con las playlists asignadas.</p>
          </div>
        </div>
        <input type="hidden" id="editUserCategory" value="admin">
      </div>

      <!-- Subcategor√≠a Admin -->
      <div id="editAdminSubWrap" style="margin-top:12px">
        <label class="field-label">Nivel de acceso en el panel</label>
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:6px">
          <label style="cursor:pointer;display:flex;align-items:flex-start;gap:10px;padding:10px 14px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius-sm)">
            <input type="radio" name="editUserRole" value="admin" style="margin-top:2px;accent-color:var(--blue-bright)">
            <div><strong style="font-size:13px">‚öôÔ∏è Administrador</strong><br><span style="font-size:12px;color:var(--gray-500)">Cursos, proyectos, contenido y configuraci√≥n.</span></div>
          </label>
          <label style="cursor:pointer;display:flex;align-items:flex-start;gap:10px;padding:10px 14px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius-sm)">
            <input type="radio" name="editUserRole" value="editor" style="margin-top:2px;accent-color:var(--blue-bright)">
            <div><strong style="font-size:13px">‚úèÔ∏è Editor</strong><br><span style="font-size:12px;color:var(--gray-500)">Solo edita cursos y proyectos.</span></div>
          </label>
        </div>
      </div>

      <!-- Subcategor√≠a Estudiante: playlists -->
      <div id="editUserPlaylistWrap" style="display:none;margin-top:12px">
        <div class="field-group">
          <label class="field-label"><i class="fas fa-list-ul" style="color:var(--green-neon)"></i> Playlists asignadas</label>
          <div id="editUserPlaylistCheckboxes" style="display:flex;flex-direction:column;gap:8px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius-sm);padding:12px 14px;max-height:200px;overflow-y:auto;margin-top:6px">
            <div style="color:var(--gray-500);font-size:13px"><i class="fas fa-spinner fa-spin"></i> Cargando...</div>
          </div>
        </div>
      </div>

      <!-- Fecha de creaci√≥n -->
      <div id="editUserCreatedRow" style="display:none;margin-top:12px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);border-radius:var(--radius-sm);padding:10px 14px;font-size:12px;color:var(--gray-500)">
        <i class="fas fa-calendar-alt" style="color:var(--gray-600);margin-right:6px"></i> Creado el: <span id="editUserCreatedAt" style="color:var(--gray-300)">‚Äî</span>
      </div>
    </div>
    <div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal('modalEditUser')">Cancelar</button><button class="btn btn-primary" onclick="saveEditUser()"><i class="fas fa-save"></i> Guardar Cambios</button></div>
  </div>
</div>

<!-- MODAL AGREGAR/EDITAR VIDEO -->
<div class="modal-overlay" id="modalVideo">
  <div class="modal" style="max-width:580px">
    <div class="modal-header">
      <h3 id="videoModalTitle"><i class="fas fa-video" style="color:var(--blue-glow);margin-right:8px"></i>Agregar Video</h3>
      <button class="modal-close" onclick="closeModal('modalVideo')"><i class="fas fa-times"></i></button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="videoId">
      <input type="hidden" id="videoCourseId">
      <div class="field-group"><label class="field-label">T√≠tulo del video</label><input type="text" class="field-input" id="videoTitle" placeholder="Ej: Introducci√≥n al curso"></div>
      <div class="field-row">
        <div class="field-group">
          <label class="field-label">Secci√≥n / M√≥dulo</label>
          <input type="text" class="field-input" id="videoSection" placeholder="Ej: M√≥dulo 1 ¬∑ Fundamentos" list="sectionSuggestions">
          <datalist id="sectionSuggestions"></datalist>
          <div style="font-size:11px;color:var(--gray-600);margin-top:4px">Agrupa los videos en m√≥dulos usando el mismo nombre de secci√≥n.</div>
        </div>
        <div class="field-group"><label class="field-label">Orden dentro de la secci√≥n</label><input type="number" class="field-input" id="videoOrder" placeholder="1" min="1"></div>
      </div>
      <div class="field-group">
        <label class="field-label"><i class="fas fa-link" style="color:var(--blue-glow)"></i> URL del video</label>
        <input type="url" class="field-input" id="videoUrl" placeholder="YouTube o Cloudinary URL">
        <div style="font-size:11px;color:var(--gray-600);margin-top:4px">
          YouTube: <span style="color:var(--gray-400)">https://youtube.com/watch?v=...</span><br>
          Cloudinary: <span style="color:var(--gray-400)">https://res.cloudinary.com/.../video.mp4</span>
        </div>
      </div>
      <div class="field-row">
        <div class="field-group"><label class="field-label">Duraci√≥n</label><input type="text" class="field-input" id="videoDur" placeholder="Ej: 12:35"></div>
        <div class="field-group"><label class="field-label">Descripci√≥n breve</label><input type="text" class="field-input" id="videoDesc" placeholder="De qu√© trata este video"></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modalVideo')">Cancelar</button>
      <button class="btn btn-primary" onclick="saveVideo()"><i class="fas fa-save"></i> Guardar Video</button>
    </div>
  </div>
</div>

<div class="toast-container" id="toastContainer"></div>

<!-- ============================================================
     FIREBASE SDK
     ============================================================ -->
<script type="module">
// ‚îÄ‚îÄ‚îÄ IMPORTAR FIREBASE DESDE CDN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
import {
  getFirestore, collection, doc,
  addDoc, setDoc, updateDoc, deleteDoc, getDocs, onSnapshot,
  serverTimestamp, query, orderBy
} from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

// ‚îÄ‚îÄ‚îÄ CONFIGURACI√ìN FIREBASE (hardcoded) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const FIREBASE_CONFIG = {
  apiKey: "AIzaSyAkrDAE44YRJefO-Bs8CCdrsOGzJ1dnS80",
  authDomain: "cursos-adrian-crea.firebaseapp.com",
  projectId: "cursos-adrian-crea",
  storageBucket: "cursos-adrian-crea.firebasestorage.app",
  messagingSenderId: "1054676254470",
  appId: "1:1054676254470:web:c68c00c3e3cd7a2d73a887"
};

// ‚îÄ‚îÄ‚îÄ INICIALIZAR FIREBASE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let app, db;

function setFbStatus(ok, msg) {
  const badge = document.getElementById('fbStatusBadge');
  if (!badge) return;
  badge.className = 'fb-status' + (ok ? '' : ' disconnected');
  badge.innerHTML = `<span class="fb-dot"></span> ${msg || (ok ? 'Firebase conectado' : 'Error Firebase')}`;
}

try {
  app = initializeApp(FIREBASE_CONFIG);
  db  = getFirestore(app);
  window._db = db;
  window._fb = { collection, doc, addDoc, setDoc, updateDoc, deleteDoc, getDocs, onSnapshot, serverTimestamp, query, orderBy };
  setFbStatus(true, 'Firebase conectado');

  // ‚îÄ‚îÄ‚îÄ CARGAR DATOS EN TIEMPO REAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  onSnapshot(
    query(collection(db,'projects'), orderBy('createdAt','desc')),
    snap => {
      window._projects = snap.docs.map(d => ({id:d.id,...d.data()}));
      renderProjects(window._currentProjFilter || 'all');
      updateStats();
    },
    err => { console.error('Error proyectos:', err); setFbStatus(false, 'Error: ' + err.code); }
  );

  onSnapshot(
    query(collection(db,'courses'), orderBy('createdAt','desc')),
    snap => {
      window._courses = snap.docs.map(d => ({id:d.id,...d.data()}));
      renderCourses();
      updateStats();
      populateCourseSelectors(); // Update playlist course selector & user checkboxes
    },
    err => { console.error('Error cursos:', err); }
  );

  onSnapshot(
    collection(db,'users'),
    snap => {
      window._users = snap.docs.map(d => ({id:d.id,...d.data()}));
      renderUsers();
      updateStats();
    },
    err => { console.error('Error usuarios:', err); }
  );

  // Playlists
  onSnapshot(
    query(collection(db,'playlists'), orderBy('order','asc')),
    snap => {
      window._playlists = snap.docs.map(d => ({id:d.id,...d.data()}));
      if(window._currentPlaylistCourse) renderAdminPlaylist(window._currentPlaylistCourse);
    },
    err => { console.error('Error playlists:', err); }
  );

} catch(e) {
  console.error('Firebase init error:', e);
  setFbStatus(false, 'Error al iniciar Firebase');
}

window._getConfig = () => FIREBASE_CONFIG;
</script>

<script>
// ‚îÄ‚îÄ‚îÄ DATOS LOCALES (fallback / auth) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DB = {
  users:[
    {id:'1',name:'Adrian Garc√≠a',login:'adrian',pass:'admin123',role:'superadmin',email:'adrian@adriancreativo.com',active:true}
  ],
  projects:[],
  courses:[]
};
window.DB = DB;
window._projects = [];
window._courses  = [];
window._users    = [];
window._currentProjFilter = 'all';

let currentUser = null, loginTab = 'admin';

// ‚îÄ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setTab(tab){
  loginTab=tab;
  document.querySelectorAll('.login-tab').forEach((t,i)=>t.classList.toggle('active',(i===0&&tab==='admin')||(i===1&&tab==='user')));
}

function doLogin(){
  const u=document.getElementById('loginUser').value.trim();
  const p=document.getElementById('loginPass').value;
  const err=document.getElementById('loginError');
  const msg=document.getElementById('loginErrorMsg');
  // Buscar en DB local Y en _users de Firebase
  const allUsers=[...DB.users,...(window._users||[])];
  const found=allUsers.find(x=>x.login===u&&x.pass===p);
  if(!found){
    err.classList.add('show');msg.textContent='Usuario o contrase√±a incorrectos';
    setTimeout(()=>err.classList.remove('show'),3000);return;
  }
  // Si la cuenta est√° inactiva
  if(found.active===false){
    err.classList.add('show');msg.textContent='Esta cuenta est√° desactivada';
    setTimeout(()=>err.classList.remove('show'),3000);return;
  }
  // Tab "admin" requiere rol admin/editor/superadmin
  if(loginTab==='admin'&&found.role!=='superadmin'&&found.role!=='admin'&&found.role!=='editor'&&found.role!=='courses'){
    err.classList.add('show');msg.textContent='Sin acceso al panel';
    setTimeout(()=>err.classList.remove('show'),3000);return;
  }
  currentUser=found;
  // Guardar sesi√≥n para que cursos.html pueda leerla
  try{ sessionStorage.setItem('ac_user', JSON.stringify(found)); }catch(e){}
  initApp();
}

function doLogout(){
  currentUser=null;
  try{ sessionStorage.removeItem('ac_user'); }catch(e){}
  document.getElementById('appShell').classList.remove('visible');
  document.getElementById('loginScreen').style.display='flex';
  document.getElementById('loginUser').value='';
  document.getElementById('loginPass').value='';
}

function initApp(){
  document.getElementById('loginScreen').style.display='none';
  document.getElementById('appShell').classList.add('visible');
  const initials=currentUser.name.split(' ').map(n=>n[0]).join('').slice(0,2).toUpperCase();
  document.getElementById('sidebarAvatar').textContent=initials;
  document.getElementById('sidebarName').textContent=currentUser.name;
  const roleLabels={superadmin:'Superusuario',admin:'Administrador',editor:'Editor',courses:'Solo Cursos'};
  document.getElementById('sidebarRole').textContent=roleLabels[currentUser.role]||'Usuario';

  const isAdmin   = currentUser.role==='superadmin'||currentUser.role==='admin';
  const isEditor  = currentUser.role==='editor';
  const isCoursesOnly = currentUser.role==='courses';

  // Mostrar/ocultar items de navegaci√≥n seg√∫n rol
  document.getElementById('nav-users').style.display    = isAdmin ? 'flex' : 'none';
  document.getElementById('nav-admin-label').style.display = isAdmin ? 'block' : 'none';
  const qu=document.getElementById('quickUsers'); if(qu) qu.style.display=isAdmin?'flex':'none';

  if(isCoursesOnly){
    // Ocultar todo excepto Cursos
    ['nav-home','nav-about','nav-contact','nav-projects','nav-settings'].forEach(id=>{
      const el=document.getElementById(id); if(el) el.style.display='none';
    });
    document.querySelectorAll('.nav-section-label').forEach(el=>el.style.display='none');
    // Navegar directamente a Cursos
    navigate('pageCourses');
  } else {
    // Restaurar visibilidad normal
    ['nav-home','nav-about','nav-contact','nav-projects','nav-settings'].forEach(id=>{
      const el=document.getElementById(id); if(el) el.style.display='flex';
    });
    document.querySelectorAll('.nav-section-label').forEach(el=>el.style.display='block');
  }

  // Cargar config Firebase en Settings
  loadFirebaseConfigForm();
  updateStats();
}

// ‚îÄ‚îÄ‚îÄ NAVEGACI√ìN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const pageLabels={
  dashboard:'Dashboard <span>/ Inicio</span>',
  pageHome:'P√°gina de Inicio <span>/ Hero & CTA</span>',
  pageAbout:'Acerca de Nosotros <span>/ Editar</span>',
  pageContact:'Cont√°ctanos <span>/ Redes Sociales</span>',
  pageProjects:'Proyectos <span>/ Gestionar</span>',
  pageCourses:'Cursos <span>/ Cat√°logo</span>',
  pageUsers:'Usuarios <span>/ Gestionar</span>',
  pageSettings:'Configuraci√≥n <span>/ Sistema</span>'
};

function navigate(pageId){
  // Bloquear p√°ginas no permitidas para rol "Solo Cursos"
  if(currentUser && currentUser.role === 'courses'){
    if(pageId !== 'pageCourses'){
      showToast('info','Acceso restringido','Tu cuenta solo tiene acceso a la secci√≥n de Cursos.');
      pageId = 'pageCourses';
    }
  }
  document.querySelectorAll('.page-content').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  const page=document.getElementById('page-'+pageId);
  if(page)page.classList.add('active');
  const navMap={pageHome:'nav-home',pageAbout:'nav-about',pageContact:'nav-contact',pageProjects:'nav-projects',pageCourses:'nav-courses',pageUsers:'nav-users',pageSettings:'nav-settings'};
  if(navMap[pageId]){const el=document.getElementById(navMap[pageId]);if(el)el.classList.add('active');}
  else document.querySelector('.nav-item').classList.add('active');
  document.getElementById('topbarTitle').innerHTML=pageLabels[pageId]||pageId;
  if(window.innerWidth<=768){document.getElementById('sidebar').classList.remove('open');document.getElementById('sidebarOverlay').classList.remove('open');}
}

function toggleSidebar(){
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('sidebarOverlay').classList.toggle('open');
}

function switchSubTab(btn,sectionId){
  const parent=btn.closest('.page-content');
  parent.querySelectorAll('.section-tab').forEach(t=>t.classList.remove('active'));
  parent.querySelectorAll('.page-section-editor').forEach(s=>s.classList.remove('active'));
  btn.classList.add('active');
  const el=document.getElementById(sectionId);if(el)el.classList.add('active');
}

// ‚îÄ‚îÄ‚îÄ RENDER PROYECTOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderProjects(filter='all'){
  window._currentProjFilter=filter;
  const body=document.getElementById('projectsBody');
  const items=(filter==='all'?window._projects:window._projects.filter(p=>p.cat===filter));
  if(items.length===0){
    body.innerHTML=`<tr><td colspan="4" style="text-align:center;padding:30px;color:var(--gray-400)">Sin proyectos${filter!=='all'?' en esta categor√≠a':''}. Agrega el primero.</td></tr>`;
    return;
  }
  const catIcons={ai:'ü§ñ',psd:'üé®',video:'üé¨'};
  const catLabels={ai:'AI',psd:'PSD',video:'Video'};
  body.innerHTML=items.map(p=>`<tr>
    <td><div style="display:flex;align-items:center;gap:10px">
      <div style="width:38px;height:38px;border-radius:8px;background:rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:center;font-size:18px">${catIcons[p.cat]||'üìÅ'}</div>
      <div><strong style="font-size:14px">${p.name}</strong><span style="display:block;font-size:12px;color:var(--gray-400)">${p.desc||''}</span></div>
    </div></td>
    <td><span class="badge-pill ${p.cat==='ai'?'badge-blue':p.cat==='psd'?'badge-orange':'badge-red'}">${catLabels[p.cat]||p.cat}</span></td>
    <td><span class="badge-pill ${p.status==='published'?'badge-green':'badge-gray'}">${p.status==='published'?'‚úì Publicado':'Borrador'}</span></td>
    <td><div style="display:flex;gap:6px">
      <button class="btn btn-sm btn-danger" onclick="deleteProject('${p.id}')"><i class="fas fa-trash"></i></button>
    </div></td>
  </tr>`).join('');
}

function filterProjects(cat,btn){
  btn.closest('.section-tabs').querySelectorAll('.section-tab').forEach(t=>t.classList.remove('active'));
  btn.classList.add('active');renderProjects(cat);
}

// ‚îÄ‚îÄ‚îÄ RENDER CURSOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderCourses(){
  const body=document.getElementById('coursesBody');
  const catLabels={ai:'ü§ñ AI',psd:'üé® PSD',video:'üé¨ Video',general:'üìö General'};
  const lvlColor={beginner:'badge-green',intermediate:'badge-blue',advanced:'badge-red'};
  const lvlLabel={beginner:'Principiante',intermediate:'Intermedio',advanced:'Avanzado'};
  if(window._courses.length===0){
    body.innerHTML=`<tr><td colspan="5" style="text-align:center;padding:30px;color:var(--gray-400)">Sin cursos. Agrega el primero.</td></tr>`;
    return;
  }
  body.innerHTML=window._courses.map(c=>`<tr>
    <td><div style="display:flex;align-items:center;gap:10px">
      <div style="width:38px;height:38px;border-radius:8px;background:linear-gradient(135deg,rgba(26,26,255,0.3),rgba(0,255,136,0.15));display:flex;align-items:center;justify-content:center;font-size:16px">üéì</div>
      <div><strong style="font-size:14px">${c.name}</strong>
      <span style="display:block;font-size:12px;color:var(--gray-400)">${c.dur||'‚Äî'} ¬∑ <span class="badge-pill ${lvlColor[c.level]||'badge-gray'}" style="padding:1px 7px;font-size:10px">${lvlLabel[c.level]||c.level}</span></span></div>
    </div></td>
    <td><span style="font-size:13px">${catLabels[c.cat]||c.cat}</span></td>
    <td><strong style="font-family:'JetBrains Mono',monospace;font-size:15px;color:var(--green-neon)">${c.price||0} <span style="font-size:11px;font-weight:400;color:var(--gray-500)">${c.currency||'USD'}</span></strong></td>
    <td><span class="badge-pill ${c.status==='published'?'badge-green':c.status==='draft'?'badge-gray':'badge-orange'}">${c.status==='published'?'‚úì Publicado':c.status==='draft'?'Borrador':'Pr√≥ximamente'}</span></td>
    <td><div style="display:flex;gap:6px">
      <button class="btn btn-sm btn-primary" onclick="goToPlaylist('${c.id}')" title="Gestionar Playlist"><i class="fas fa-list-ul"></i></button>
      <button class="btn btn-sm btn-danger" onclick="deleteCourse('${c.id}')"><i class="fas fa-trash"></i></button>
    </div></td>
  </tr>`).join('');
  document.getElementById('coursesBadge').textContent=window._courses.filter(c=>c.status==='published').length;
}

// ‚îÄ‚îÄ‚îÄ POPULATE COURSE SELECTORS (playlist page + user checkboxes) ‚îÄ‚îÄ‚îÄ
function populateCourseSelectors(){
  const courses = window._courses || [];
  // Playlist page selector
  const sel = document.getElementById('playlistCourseSelect');
  if(sel){
    const prev = sel.value;
    sel.innerHTML = '<option value="">‚Äî Elige un curso ‚Äî</option>' +
      courses.map(c=>`<option value="${c.id}">${c.name}</option>`).join('');
    if(prev) sel.value = prev;
  }
  // User playlist checkboxes
  buildPlaylistCheckboxes('userPlaylistCheckboxes', []);
}

function buildPlaylistCheckboxes(containerId, selectedIds){
  const wrap = document.getElementById(containerId);
  if(!wrap) return;
  const courses = window._courses || [];
  if(!courses.length){
    wrap.innerHTML = '<div style="color:var(--gray-500);font-size:13px">No hay cursos creados a√∫n.</div>';
    return;
  }
  wrap.innerHTML = `
    <label style="display:flex;align-items:center;gap:8px;cursor:pointer;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.05)">
      <input type="checkbox" id="pl-all" value="all" onchange="handleAllPlaylistCheck('${containerId}')"
        ${selectedIds.includes('all')?'checked':''} style="accent-color:var(--green-neon);width:15px;height:15px">
      <span style="font-size:13px;font-weight:600;color:var(--green-neon)">‚ú¶ Acceso a todos los cursos</span>
    </label>` +
    courses.map(c=>`
    <label style="display:flex;align-items:center;gap:8px;cursor:pointer;padding:5px 0">
      <input type="checkbox" class="pl-course-check" value="${c.id}"
        ${selectedIds.includes('all')||selectedIds.includes(c.id)?'checked':''}
        style="accent-color:var(--blue-bright);width:15px;height:15px">
      <span style="font-size:13px">${c.name}</span>
    </label>`).join('');
}

window.handleAllPlaylistCheck = function(containerId){
  const allBox = document.getElementById('pl-all');
  const boxes  = document.querySelectorAll(`#${containerId} .pl-course-check`);
  boxes.forEach(b => b.disabled = allBox.checked);
};

function getSelectedPlaylists(containerId){
  const allBox = document.getElementById('pl-all');
  if(allBox?.checked) return ['all'];
  return [...document.querySelectorAll(`#${containerId} .pl-course-check:checked`)].map(b=>b.value);
}

window.togglePlaylistAccess = function(wrapId, role){
  const wrap = document.getElementById(wrapId);
  if(!wrap) return;
  wrap.style.display = (role==='courses') ? 'block' : 'none';
};

// ‚îÄ‚îÄ‚îÄ GO TO PLAYLIST PAGE FOR A COURSE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function goToPlaylist(courseId){
  navigate('pagePlaylists');
  const sel = document.getElementById('playlistCourseSelect');
  if(sel){ sel.value = courseId; loadAdminPlaylist(); }
}

// ‚îÄ‚îÄ‚îÄ ADMIN PLAYLIST LOAD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.loadAdminPlaylist = function(){
  const courseId = document.getElementById('playlistCourseSelect').value;
  if(!courseId){
    document.getElementById('playlistAdminContent').style.display='none';
    document.getElementById('playlistEmptyMsg').style.display='block';
    document.getElementById('btnAddVideo').style.display='none';
    return;
  }
  window._currentPlaylistCourse = courseId;
  const course = (window._courses||[]).find(c=>c.id===courseId);
  document.getElementById('playlistAdminTitle').textContent = course ? `üìã ${course.name}` : '';
  document.getElementById('playlistAdminContent').style.display='block';
  document.getElementById('playlistEmptyMsg').style.display='none';
  document.getElementById('btnAddVideo').style.display='flex';
  renderAdminPlaylist(courseId);
};

function renderAdminPlaylist(courseId){
  const body = document.getElementById('playlistBody');
  if(!body) return;
  const all = (window._playlists||[]).filter(v=>v.courseId===courseId);
  if(!all.length){
    body.innerHTML=`<tr><td colspan="6" style="text-align:center;padding:24px;color:var(--gray-400)">Sin videos a√∫n. Agrega el primero.</td></tr>`;
    return;
  }
  // Update section filter
  const sections = [...new Set(all.map(v=>v.section||'Principal'))];
  const secSel = document.getElementById('plSectionFilter');
  if(secSel){
    secSel.innerHTML = '<option value="all">Todas las secciones</option>' +
      sections.map(s=>`<option value="${s}">${s}</option>`).join('');
  }
  // Update datalist for video modal
  const dl = document.getElementById('sectionSuggestions');
  if(dl) dl.innerHTML = sections.map(s=>`<option value="${s}">`).join('');

  let idx=1;
  body.innerHTML = all.map(v=>`<tr>
    <td style="font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--gray-500)">${idx++}</td>
    <td><strong style="font-size:13px">${v.title||'Sin t√≠tulo'}</strong></td>
    <td><span style="font-size:12px;background:rgba(26,26,255,0.15);padding:3px 8px;border-radius:100px">${v.section||'‚Äî'}</span></td>
    <td style="font-size:13px;color:var(--gray-400)">${v.dur||'‚Äî'}</td>
    <td style="max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">
      ${v.url?`<a href="${v.url}" target="_blank" style="color:var(--blue-glow);font-size:12px"><i class="fas fa-external-link-alt"></i> Ver</a>`:'<span style="color:var(--gray-600);font-size:12px">Sin URL</span>'}
    </td>
    <td><div style="display:flex;gap:6px">
      <button class="btn btn-sm btn-primary" onclick="editVideo('${v.id}')" title="Editar"><i class="fas fa-edit"></i></button>
      <button class="btn btn-sm btn-danger" onclick="deleteVideo('${v.id}')" title="Eliminar"><i class="fas fa-trash"></i></button>
    </div></td>
  </tr>`).join('');
}

window.filterPlaylistSection = function(){
  const filter = document.getElementById('plSectionFilter').value;
  const courseId = document.getElementById('playlistCourseSelect').value;
  if(!courseId) return;
  const all = (window._playlists||[]).filter(v=>v.courseId===courseId);
  const body = document.getElementById('playlistBody');
  const filtered = filter==='all' ? all : all.filter(v=>(v.section||'Principal')===filter);
  if(!filtered.length){ body.innerHTML=`<tr><td colspan="6" style="text-align:center;padding:20px;color:var(--gray-400)">Sin videos en esta secci√≥n.</td></tr>`; return; }
  let idx=1;
  body.innerHTML = filtered.map(v=>`<tr>
    <td style="font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--gray-500)">${idx++}</td>
    <td><strong style="font-size:13px">${v.title||'Sin t√≠tulo'}</strong></td>
    <td><span style="font-size:12px;background:rgba(26,26,255,0.15);padding:3px 8px;border-radius:100px">${v.section||'‚Äî'}</span></td>
    <td style="font-size:13px;color:var(--gray-400)">${v.dur||'‚Äî'}</td>
    <td>${v.url?`<a href="${v.url}" target="_blank" style="color:var(--blue-glow);font-size:12px"><i class="fas fa-external-link-alt"></i> Ver</a>`:'<span style="color:var(--gray-600);font-size:12px">Sin URL</span>'}</td>
    <td><div style="display:flex;gap:6px">
      <button class="btn btn-sm btn-primary" onclick="editVideo('${v.id}')"><i class="fas fa-edit"></i></button>
      <button class="btn btn-sm btn-danger" onclick="deleteVideo('${v.id}')"><i class="fas fa-trash"></i></button>
    </div></td>
  </tr>`).join('');
};

// ‚îÄ‚îÄ‚îÄ OPEN ADD VIDEO MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.openAddVideo = function(){
  const courseId = document.getElementById('playlistCourseSelect').value;
  if(!courseId){ showToast('error','Error','Selecciona un curso primero'); return; }
  document.getElementById('videoModalTitle').innerHTML = '<i class="fas fa-video" style="color:var(--blue-glow);margin-right:8px"></i>Agregar Video';
  document.getElementById('videoId').value = '';
  document.getElementById('videoCourseId').value = courseId;
  ['videoTitle','videoSection','videoUrl','videoDur','videoDesc'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('videoOrder').value = ((window._playlists||[]).filter(v=>v.courseId===courseId).length + 1);
  openModal('modalVideo');
};

window.editVideo = function(videoId){
  const v = (window._playlists||[]).find(x=>x.id===videoId);
  if(!v) return;
  document.getElementById('videoModalTitle').innerHTML = '<i class="fas fa-edit" style="color:var(--green-neon);margin-right:8px"></i>Editar Video';
  document.getElementById('videoId').value      = v.id;
  document.getElementById('videoCourseId').value= v.courseId||'';
  document.getElementById('videoTitle').value   = v.title||'';
  document.getElementById('videoSection').value = v.section||'';
  document.getElementById('videoOrder').value   = v.order||1;
  document.getElementById('videoUrl').value     = v.url||'';
  document.getElementById('videoDur').value     = v.dur||'';
  document.getElementById('videoDesc').value    = v.desc||'';
  openModal('modalVideo');
};

window.saveVideo = async function(){
  const title    = document.getElementById('videoTitle').value.trim();
  const courseId = document.getElementById('videoCourseId').value;
  const editId   = document.getElementById('videoId').value;
  if(!title){ showToast('error','Error','El t√≠tulo es requerido'); return; }
  if(!courseId){ showToast('error','Error','Sin curso asignado'); return; }
  const data = {
    courseId,
    title,
    section:  document.getElementById('videoSection').value.trim() || 'Secci√≥n 1',
    order:    parseInt(document.getElementById('videoOrder').value)||1,
    url:      document.getElementById('videoUrl').value.trim(),
    dur:      document.getElementById('videoDur').value.trim(),
    desc:     document.getElementById('videoDesc').value.trim(),
  };
  if(!window._db){ showToast('error','Sin Firebase','No hay conexi√≥n'); return; }
  const {collection,doc,addDoc,setDoc,serverTimestamp}=window._fb;
  try{
    if(editId){
      await setDoc(doc(window._db,'playlists',editId), data, {merge:true});
      showToast('success','Video actualizado','Guardado ‚úì');
    } else {
      data.createdAt = serverTimestamp();
      await addDoc(collection(window._db,'playlists'), data);
      showToast('success','Video agregado','Guardado en Firebase ‚úì');
    }
    closeModal('modalVideo');
  } catch(e){ showToast('error','Error Firebase',e.message); }
};

window.deleteVideo = async function(videoId){
  if(!confirm('¬øEliminar este video de la playlist?')) return;
  if(!window._db) return;
  const {doc,deleteDoc}=window._fb;
  try{
    await deleteDoc(doc(window._db,'playlists',videoId));
    showToast('info','Video eliminado','Eliminado de Firebase');
  }catch(e){ showToast('error','Error Firebase',e.message); }
};

// ‚îÄ‚îÄ‚îÄ RENDER USUARIOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window._usersMap = {};

function formatDate(ts){
  if(!ts) return '‚Äî';
  try{
    const d = ts.toDate ? ts.toDate() : new Date(ts);
    return d.toLocaleDateString('es-HN',{day:'2-digit',month:'short',year:'numeric'});
  }catch(e){return '‚Äî';}
}

function getRoleInfo(role){
  const map = {
    superadmin: {label:'‚≠ê Superusuario', badge:'badge-green', cat:'üõ°Ô∏è Admin'},
    admin:      {label:'‚öôÔ∏è Administrador', badge:'badge-blue',  cat:'üõ°Ô∏è Admin'},
    editor:     {label:'‚úèÔ∏è Editor',        badge:'badge-orange', cat:'üõ°Ô∏è Admin'},
    courses:    {label:'üéì Estudiante',    badge:'badge-teal',  cat:'üéì Cursos'},
  };
  return map[role] || {label:role, badge:'badge-gray', cat:'‚Äî'};
}

function renderUsers(){
  const body=document.getElementById('usersBody');
  const allU=[...DB.users,...window._users.filter(u=>!DB.users.find(d=>d.login===u.login))];
  allU.forEach(u => { window._usersMap[u.id] = u; });
  body.innerHTML=allU.map(u=>{
    const ri = getRoleInfo(u.role);
    return `<tr>
      <td><div style="display:flex;align-items:center;gap:10px">
        <div class="mini-avatar">${u.name.split(' ').map(n=>n[0]).join('').slice(0,2)}</div>
        <div><strong style="font-size:14px">${u.name}</strong><span style="display:block;font-size:12px;color:var(--gray-400)">@${u.login}${u.email?' ¬∑ '+u.email:''}</span></div>
      </div></td>
      <td>
        <div style="display:flex;flex-direction:column;gap:4px">
          <span style="font-size:11px;color:var(--gray-500);font-weight:600">${ri.cat}</span>
          <span class="badge-pill ${ri.badge}">${ri.label}</span>
        </div>
      </td>
      <td><span class="badge-pill ${u.active!==false?'badge-green':'badge-red'}">${u.active!==false?'‚óè Activo':'‚óè Inactivo'}</span></td>
      <td style="font-size:12px;color:var(--gray-500);white-space:nowrap">${formatDate(u.createdAt)}</td>
      <td><div style="display:flex;gap:6px;align-items:center">
        ${u.role!=='superadmin'&&u.id!=='1'
          ? `<button class="btn btn-sm btn-primary" onclick="openEditUser('${u.id}')" title="Editar"><i class="fas fa-edit"></i></button>
             <button class="btn btn-sm btn-danger" onclick="deleteUser('${u.id}')" title="Eliminar"><i class="fas fa-trash"></i></button>`
          : '<span style="color:var(--gray-600);font-size:12px">Protegido</span>'}
      </div></td>
    </tr>`;
  }).join('');
}

// ‚îÄ‚îÄ‚îÄ ESTAD√çSTICAS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateStats(){
  document.getElementById('statCourses').textContent=window._courses.filter(c=>c.status==='published').length;
  document.getElementById('statUsers').textContent=(DB.users.length + window._users.length);
  document.getElementById('statProjects').textContent=window._projects.filter(p=>p.status==='published').length;
  // Render recent users widget in dashboard
  const allU=[...DB.users,...window._users.filter(u=>!DB.users.find(d=>d.login===u.login))];
  const recent = allU.slice().reverse().slice(0,5);
  const container = document.getElementById('dashRecentUsers');
  if(!container) return;
  if(!recent.length){
    container.innerHTML='<div style="padding:20px;text-align:center;color:var(--gray-600);font-size:13px">Sin usuarios registrados</div>';
    return;
  }
  container.innerHTML = recent.map(u=>{
    const ri = getRoleInfo(u.role);
    const initials = u.name.split(' ').map(n=>n[0]).join('').slice(0,2);
    return `<div style="display:flex;align-items:center;justify-content:space-between;padding:10px 18px;border-bottom:1px solid rgba(255,255,255,0.04)">
      <div style="display:flex;align-items:center;gap:10px">
        <div class="mini-avatar" style="width:28px;height:28px;font-size:11px">${initials}</div>
        <div>
          <div style="font-size:13px;font-weight:600">${u.name}</div>
          <div style="font-size:11px;color:var(--gray-500)">@${u.login}</div>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:3px">
        <span class="badge-pill ${ri.badge}" style="padding:2px 8px;font-size:11px">${ri.label}</span>
        <span style="font-size:10px;color:var(--gray-600)">${formatDate(u.createdAt)}</span>
      </div>
    </div>`;
  }).join('');
}

// ‚îÄ‚îÄ‚îÄ AGREGAR / ELIMINAR PROYECTOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function addProject(){
  const name=document.getElementById('projName').value.trim();
  if(!name){showToast('error','Error','El nombre es requerido');return;}
  const data={name,cat:document.getElementById('projCat').value,status:document.getElementById('projStatus').value,desc:document.getElementById('projDesc').value,createdAt:null};
  if(window._db){
    try{
      const {addDoc,collection,serverTimestamp}=window._fb;
      data.createdAt=serverTimestamp();
      await addDoc(collection(window._db,'projects'),data);
      showToast('success','Proyecto creado','Guardado en Firebase ‚úì');
    }catch(e){showToast('error','Error Firebase',e.message);return;}
  } else {
    data.id=Date.now().toString();data.createdAt=new Date();
    window._projects.unshift(data);renderProjects(window._currentProjFilter);updateStats();
    showToast('info','Proyecto creado','(Sin Firebase ‚Äî no se guardar√° al recargar)');
  }
  closeModal('modalProject');
  document.getElementById('projName').value='';document.getElementById('projDesc').value='';
}

async function deleteProject(id){
  if(!confirm('¬øEliminar este proyecto?'))return;
  if(window._db){
    try{
      const {doc,deleteDoc}=window._fb;
      await deleteDoc(doc(window._db,'projects',id));
      showToast('info','Proyecto eliminado','Eliminado de Firebase');
    }catch(e){showToast('error','Error Firebase',e.message);}
  } else {
    window._projects=window._projects.filter(p=>p.id!==id);
    renderProjects(window._currentProjFilter);updateStats();
    showToast('info','Proyecto eliminado','Eliminado localmente');
  }
}

// ‚îÄ‚îÄ‚îÄ AGREGAR / ELIMINAR CURSOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function addCourse(){
  const name=document.getElementById('courseName').value.trim();
  if(!name){showToast('error','Error','El t√≠tulo del curso es requerido');return;}
  const data={
    name, cat:document.getElementById('courseCat').value,
    price:parseFloat(document.getElementById('coursePrice').value)||0,
    currency:(document.getElementById('courseCurrency').value.trim().toUpperCase()||'USD'),
    level:document.getElementById('courseLevel').value,
    dur:document.getElementById('courseDur').value||'‚Äî',
    lessons:parseInt(document.getElementById('courseLessons').value)||0,
    status:document.getElementById('courseStatus').value,
    desc:document.getElementById('courseDesc').value,
    imageUrl:document.getElementById('courseImageUrl').value.trim()||'',
    videoUrl:document.getElementById('courseVideoUrl').value.trim()||'',
    createdAt:null
  };
  if(window._db){
    try{
      const {addDoc,collection,serverTimestamp}=window._fb;
      data.createdAt=serverTimestamp();
      await addDoc(collection(window._db,'courses'),data);
      showToast('success','Curso creado','Guardado en Firebase ‚úì');
    }catch(e){showToast('error','Error Firebase',e.message);return;}
  } else {
    data.id=Date.now().toString();data.createdAt=new Date();
    window._courses.unshift(data);renderCourses();updateStats();
    showToast('info','Curso creado','(Sin Firebase)');
  }
  closeModal('modalCourse');
  ['courseName','coursePrice','courseCurrency','courseDur','courseDesc','courseLessons','courseImageUrl','courseVideoUrl'].forEach(id=>document.getElementById(id).value='');
}

async function deleteCourse(id){
  if(!confirm('¬øEliminar este curso?'))return;
  if(window._db){
    try{
      const {doc,deleteDoc}=window._fb;
      await deleteDoc(doc(window._db,'courses',id));
      showToast('info','Curso eliminado','Eliminado de Firebase');
    }catch(e){showToast('error','Error Firebase',e.message);}
  } else {
    window._courses=window._courses.filter(c=>c.id!==id);
    renderCourses();updateStats();
    showToast('info','Curso eliminado','Eliminado localmente');
  }
}

// ‚îÄ‚îÄ‚îÄ AGREGAR / ELIMINAR USUARIOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// ‚îÄ‚îÄ‚îÄ FUNCIONES DE CATEGOR√çA DE USUARIO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function selectUserCategory(cat){
  document.getElementById('userCategory').value = cat;
  document.getElementById('cat-admin-card').classList.toggle('active', cat==='admin');
  document.getElementById('cat-viewer-card').classList.toggle('active', cat==='viewer');
  document.getElementById('adminSubWrap').style.display   = cat==='admin'  ? 'block' : 'none';
  document.getElementById('userPlaylistWrap').style.display = cat==='viewer' ? 'block' : 'none';
  if(cat==='viewer') buildPlaylistCheckboxes('userPlaylistCheckboxes', []);
}

function selectEditUserCategory(cat){
  document.getElementById('editUserCategory').value = cat;
  document.getElementById('editCat-admin-card').classList.toggle('active', cat==='admin');
  document.getElementById('editCat-viewer-card').classList.toggle('active', cat==='viewer');
  document.getElementById('editAdminSubWrap').style.display   = cat==='admin'  ? 'block' : 'none';
  document.getElementById('editUserPlaylistWrap').style.display = cat==='viewer' ? 'block' : 'none';
  if(cat==='viewer') buildPlaylistCheckboxes('editUserPlaylistCheckboxes', window._editingPlaylists||[]);
}

// Determina la categor√≠a seg√∫n el rol
function catFromRole(role){
  return (role==='admin'||role==='editor'||role==='superadmin') ? 'admin' : 'viewer';
}

// Determina el rol final a guardar
function resolveRole(category){
  if(category === 'admin'){
    const sel = document.querySelector('input[name="userRole"]:checked');
    return sel ? sel.value : 'admin';
  }
  return 'courses'; // estudiante
}

function resolveEditRole(category){
  if(category === 'admin'){
    const sel = document.querySelector('input[name="editUserRole"]:checked');
    return sel ? sel.value : 'admin';
  }
  return 'courses';
}

async function addUser(){
  const name  = document.getElementById('userName').value.trim();
  const login = document.getElementById('userLogin').value.trim();
  const pass  = document.getElementById('userPass').value;
  const email = document.getElementById('userEmail').value.trim();
  const cat   = document.getElementById('userCategory').value;
  if(!name||!login||!pass){showToast('error','Error','Nombre, usuario y contrase√±a son requeridos');return;}
  const allU=[...DB.users,...window._users];
  if(allU.find(u=>u.login===login)){showToast('error','Error','Ese nombre de usuario ya existe');return;}
  const role = resolveRole(cat);
  const playlists = cat==='viewer' ? getSelectedPlaylists('userPlaylistCheckboxes') : [];
  const data={name,login,pass,email,role,playlists,active:true,createdAt:null};
  if(window._db){
    try{
      const {addDoc,collection,serverTimestamp}=window._fb;
      data.createdAt=serverTimestamp();
      await addDoc(collection(window._db,'users'),data);
      showToast('success','Usuario creado',`@${login} registrado ‚úì`);
    }catch(e){showToast('error','Error Firebase',e.message);return;}
  } else {
    data.id=Date.now().toString();data.createdAt=new Date().toISOString();
    window._users.push(data);renderUsers();updateStats();
    showToast('info','Usuario creado','(Sin Firebase)');
  }
  closeModal('modalUser');
  ['userName','userLogin','userPass','userEmail'].forEach(id=>document.getElementById(id).value='');
  selectUserCategory('admin'); // reset
}

async function deleteUser(id){
  if(!confirm('¬øEliminar este usuario?'))return;
  if(window._db){
    try{
      const {doc,deleteDoc}=window._fb;
      await deleteDoc(doc(window._db,'users',id));
      showToast('info','Usuario eliminado','Eliminado de Firebase');
    }catch(e){showToast('error','Error Firebase',e.message);}
  } else {
    window._users=window._users.filter(u=>u.id!==id);
    renderUsers();updateStats();
  }
}

// ‚îÄ‚îÄ‚îÄ VER / OCULTAR CONTRASE√ëA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// togglePass est√° definida globalmente antes del login

// ‚îÄ‚îÄ‚îÄ EDITAR USUARIO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let _editingPassPlain = '';
let _editingPlaylists = [];

function openEditUser(id){
  const u = window._usersMap[id];
  if(!u){ showToast('error','Error','No se encontr√≥ el usuario'); return; }
  document.getElementById('editUserId').value     = u.id || id;
  document.getElementById('editUserName').value   = u.name || '';
  document.getElementById('editUserLogin').value  = u.login || '';
  document.getElementById('editUserEmail').value  = u.email || '';
  document.getElementById('editUserActive').value = String(u.active !== false);

  // Contrase√±a
  const passInput = document.getElementById('editUserPass');
  passInput.value = ''; passInput.type = 'password';
  const passIcon = passInput.parentElement.querySelector('.pass-toggle i');
  if(passIcon) passIcon.className = 'fas fa-eye';
  document.getElementById('editUserPassDisplay').textContent = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
  document.getElementById('editUserPassDisplay').style.color = '';
  document.getElementById('btnRevealPass').innerHTML = '<i class="fas fa-eye"></i> Ver';
  _editingPassPlain = u.pass || '';

  // Categor√≠a y rol
  const cat = catFromRole(u.role);
  document.getElementById('editUserCategory').value = cat;
  document.getElementById('editCat-admin-card').classList.toggle('active', cat==='admin');
  document.getElementById('editCat-viewer-card').classList.toggle('active', cat==='viewer');
  document.getElementById('editAdminSubWrap').style.display   = cat==='admin'  ? 'block' : 'none';
  document.getElementById('editUserPlaylistWrap').style.display = cat==='viewer' ? 'block' : 'none';
  // Seleccionar el radio del rol correcto
  const roleRadio = document.querySelector(`input[name="editUserRole"][value="${u.role}"]`);
  if(roleRadio) roleRadio.checked = true;

  // Playlists
  _editingPlaylists = u.playlists || [];
  if(cat==='viewer') buildPlaylistCheckboxes('editUserPlaylistCheckboxes', _editingPlaylists);

  // Fecha de creaci√≥n
  if(u.createdAt){
    document.getElementById('editUserCreatedRow').style.display = 'block';
    document.getElementById('editUserCreatedAt').textContent = formatDate(u.createdAt);
  } else {
    document.getElementById('editUserCreatedRow').style.display = 'none';
  }

  openModal('modalEditUser');
}

function togglePassDisplay(){
  const display = document.getElementById('editUserPassDisplay');
  const btn     = document.getElementById('btnRevealPass');
  if(display.textContent === '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'){
    display.textContent = _editingPassPlain || '(sin contrase√±a)';
    display.style.color = 'var(--white)';
    btn.innerHTML = '<i class="fas fa-eye-slash"></i> Ocultar';
  } else {
    display.textContent = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
    display.style.color = '';
    btn.innerHTML = '<i class="fas fa-eye"></i> Ver';
  }
}

async function saveEditUser(){
  const id     = document.getElementById('editUserId').value;
  const name   = document.getElementById('editUserName').value.trim();
  const login  = document.getElementById('editUserLogin').value.trim();
  const email  = document.getElementById('editUserEmail').value.trim();
  const active = document.getElementById('editUserActive').value === 'true';
  const newPass= document.getElementById('editUserPass').value.trim();
  const cat    = document.getElementById('editUserCategory').value;

  if(!name||!login){showToast('error','Error','Nombre y usuario son obligatorios');return;}

  const role = resolveEditRole(cat);
  const updates = { name, login, email, role, active };
  if(newPass) updates.pass = newPass;
  updates.playlists = cat==='viewer' ? getSelectedPlaylists('editUserPlaylistCheckboxes') : [];

  if(window._db){
    try{
      const {doc, setDoc} = window._fb;
      await setDoc(doc(window._db,'users',id), updates, {merge:true});
      showToast('success','Usuario actualizado',`@${login} guardado ‚úì`);
      if(newPass){ _editingPassPlain = newPass; }
    }catch(e){showToast('error','Error Firebase',e.message);return;}
  } else {
    const u = window._users.find(u=>u.id===id);
    if(u){ Object.assign(u, updates); renderUsers(); }
    showToast('info','Usuario actualizado','(sin Firebase)');
  }
  closeModal('modalEditUser');
}

// ‚îÄ‚îÄ‚îÄ GUARDAR SECCIONES EN FIREBASE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function saveSection(section){
  if(!window._db){ showToast('error','Sin Firebase','No hay conexi√≥n con la base de datos'); return; }
  const {doc, setDoc} = window._fb;
  let data = {};

  if(section === 'hero'){
    data = {
      line1:   v('hero-line1'),
      line2:   v('hero-line2'),
      line3:   v('hero-line3'),
      sub:     v('hero-sub'),
      btn1:    v('hero-btn1'),
      btn2:    v('hero-btn2'),
    };
  } else if(section === 'meta'){
    data = { title: v('meta-title'), desc: v('meta-desc') };
  } else if(section === 'about'){
    data = {
      desc:      v('about-desc'),
      years:     v('about-years'),
      yearsLabel:v('about-years-label'),
      m1num:     v('about-m1-num'),  m1label: v('about-m1-label'),
      m2num:     v('about-m2-num'),  m2label: v('about-m2-label'),
      m3num:     v('about-m3-num'),  m3label: v('about-m3-label'),
      img:       v('about-img'),
    };
  } else if(section === 'contact'){
    data = {
      sub:   v('contact-sub'),
      wa:    v('contact-wa'),
      waMsg: v('contact-wa-msg'),
      fb:    v('contact-fb'),
      ig:    v('contact-ig'),
      tt:    v('contact-tt'),
    };
  } else if(section === 'images'){
    data = {
      hero:  v('img-hero'),
      about: v('img-about'),
      logo:  v('img-logo'),
    };
    // Mostrar preview
    updateImgPreviews();
  }

  // Eliminar campos vac√≠os para no sobreescribir con nada
  Object.keys(data).forEach(k => { if(!data[k]) delete data[k]; });

  if(Object.keys(data).length === 0){
    showToast('info','Sin cambios','No hay campos rellenos para guardar');
    return;
  }

  try {
    await setDoc(doc(window._db, 'site_content', section), data, { merge: true });
    showToast('success','¬°Guardado!','Los cambios se guardaron en Firebase. El sitio se actualizar√° autom√°ticamente ‚úì');
  } catch(e){
    showToast('error','Error al guardar', e.message);
  }
}

// Vista previa de im√°genes en admin
function updateImgPreviews(){
  const strip = document.getElementById('imgPreviewStrip');
  if(!strip) return;
  const imgs = [
    {id:'img-hero', label:'Hero (fondo)'},
    {id:'img-about', label:'Foto perfil'},
    {id:'img-logo', label:'Logo'},
  ];
  let html = '<div style="font-size:12px;color:var(--gray-500);width:100%;margin-bottom:4px"><i class="fas fa-eye"></i> Vista previa</div>';
  imgs.forEach(({id, label}) => {
    const url = v(id);
    if(url){
      html += `<div style="text-align:center">
        <img src="${url}" style="width:100px;height:70px;object-fit:cover;border-radius:var(--radius-sm);border:1px solid rgba(255,255,255,0.1)" 
             onerror="this.style.display='none'">
        <div style="font-size:10px;color:var(--gray-600);margin-top:4px">${label}</div>
      </div>`;
    }
  });
  strip.innerHTML = html;
}

function v(id){ const el=document.getElementById(id); return el ? el.value.trim() : ''; }

// ‚îÄ‚îÄ‚îÄ CARGAR CONTENIDO GUARDADO EN LOS CAMPOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function loadSiteContent(){
  if(!window._db) return;
  const {collection, onSnapshot} = window._fb;
  onSnapshot(collection(window._db,'site_content'), snap => {
    snap.docs.forEach(d => {
      const s = d.id, data = d.data();
      if(s === 'hero'){
        fill('hero-line1', data.line1); fill('hero-line2', data.line2);
        fill('hero-line3', data.line3); fill('hero-sub', data.sub);
        fill('hero-btn1', data.btn1);   fill('hero-btn2', data.btn2);
      } else if(s === 'meta'){
        fill('meta-title', data.title); fill('meta-desc', data.desc);
      } else if(s === 'about'){
        fill('about-desc', data.desc);
        fill('about-years', data.years); fill('about-years-label', data.yearsLabel);
        fill('about-m1-num', data.m1num); fill('about-m1-label', data.m1label);
        fill('about-m2-num', data.m2num); fill('about-m2-label', data.m2label);
        fill('about-m3-num', data.m3num); fill('about-m3-label', data.m3label);
        fill('about-img', data.img);
      } else if(s === 'contact'){
        fill('contact-sub', data.sub);   fill('contact-wa', data.wa);
        fill('contact-wa-msg', data.waMsg); fill('contact-fb', data.fb);
        fill('contact-ig', data.ig);     fill('contact-tt', data.tt);
      } else if(s === 'images'){
        fill('img-hero', data.hero);
        fill('img-about', data.about);
        fill('img-logo', data.logo);
        // Sync the about-img field too (same image)
        if(data.about) fill('about-img', data.about);
        // Show preview
        setTimeout(updateImgPreviews, 100);
      }
    });
  });
}

function fill(id, val){ const el=document.getElementById(id); if(el && val) el.value = val; }

// ‚îÄ‚îÄ‚îÄ FIREBASE CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function saveFirebaseConfig(){ showToast('info','Info','Firebase ya est√° configurado directamente en el c√≥digo'); }
function loadFirebaseConfigForm(){ loadSiteContent(); }

function changePassword(){
  const old=document.getElementById('oldPass').value;
  const np=document.getElementById('newPass').value;
  const cp=document.getElementById('confirmPass').value;
  if(!currentUser){return;}
  if(old!==currentUser.pass){showToast('error','Error','La contrase√±a actual no coincide');return;}
  if(np!==cp){showToast('error','Error','Las contrase√±as nuevas no coinciden');return;}
  if(np.length<6){showToast('error','Error','La contrase√±a debe tener al menos 6 caracteres');return;}
  currentUser.pass=np;
  showToast('success','Contrase√±a actualizada','Cambiada exitosamente (sesi√≥n actual)');
}

// ‚îÄ‚îÄ‚îÄ MODALES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openModal(id){
  document.getElementById(id).classList.add('open');
  document.body.style.overflow='hidden';
  // Initialize user playlist checkboxes when creating new user
  if(id === 'modalUser'){
    buildPlaylistCheckboxes('userPlaylistCheckboxes', []);
    togglePlaylistAccess('userPlaylistWrap', document.getElementById('userRole').value);
  }
}
function closeModal(id){document.getElementById(id).classList.remove('open');document.body.style.overflow='';}
document.querySelectorAll('.modal-overlay').forEach(o=>o.addEventListener('click',function(e){if(e.target===this)closeModal(this.id)}));
document.addEventListener('keydown',e=>{if(e.key==='Escape')document.querySelectorAll('.modal-overlay.open').forEach(m=>closeModal(m.id));});

// ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showToast(type,title,message){
  const icons={success:'fa-check-circle',error:'fa-exclamation-circle',info:'fa-info-circle'};
  const container=document.getElementById('toastContainer');
  const toast=document.createElement('div');
  toast.className=`toast ${type}`;
  toast.innerHTML=`<i class="fas ${icons[type]}"></i><div class="toast-text"><strong>${title}</strong><span>${message}</span></div>`;
  container.appendChild(toast);
  setTimeout(()=>{toast.style.animation='toastIn .3s ease reverse';setTimeout(()=>toast.remove(),300);},3500);
}

// ‚îÄ‚îÄ‚îÄ HINT DEMO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.addEventListener('DOMContentLoaded',()=>{
  const hint=document.createElement('p');
  hint.style.cssText='text-align:center;font-size:11px;color:var(--gray-600);margin-top:18px;font-family:JetBrains Mono,monospace;line-height:1.7';
  hint.innerHTML='Demo &rarr; usuario: <strong style="color:var(--gray-400)">adrian</strong> / pass: <strong style="color:var(--gray-400)">admin123</strong>';
  document.querySelector('.login-card').appendChild(hint);
});

// Exponer funciones globales necesarias
Object.assign(window,{
  setTab,doLogin,doLogout,navigate,toggleSidebar,switchSubTab,
  filterProjects,renderProjects,renderCourses,renderUsers,updateStats,
  addProject,deleteProject,addCourse,deleteCourse,addUser,deleteUser,
  openModal,closeModal,showToast,saveSection,saveFirebaseConfig,
  changePassword,loadFirebaseConfigForm,updateImgPreviews,
  togglePass,openEditUser,saveEditUser,togglePassDisplay,
  populateCourseSelectors,buildPlaylistCheckboxes,togglePlaylistAccess,
  getSelectedPlaylists,handleAllPlaylistCheck,
  loadAdminPlaylist,filterPlaylistSection,openAddVideo,editVideo,saveVideo,deleteVideo,
  goToPlaylist,
  selectUserCategory,selectEditUserCategory,formatDate,getRoleInfo
});
</script>
</body>
</html>
